# ç„Šæ¥ç¼ºé™·æ£€æµ‹æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunshansj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://gitee.com/qunmasj/projects)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

ç„Šæ¥ä½œä¸ºä¸€ç§å¹¿æ³›åº”ç”¨äºåˆ¶é€ ä¸šçš„é‡è¦è¿æ¥å·¥è‰ºï¼Œå…¶è´¨é‡ç›´æ¥å½±å“åˆ°äº§å“çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚éšç€å·¥ä¸šè‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åˆ¶é€ çš„å¿«é€Ÿå‘å±•ï¼Œä¼ ç»Ÿçš„ç„Šæ¥ç¼ºé™·æ£€æµ‹æ–¹æ³•é€æ¸æš´éœ²å‡ºæ•ˆç‡ä½ã€å‡†ç¡®æ€§å·®ç­‰é—®é¢˜ï¼ŒäºŸéœ€å¼•å…¥å…ˆè¿›çš„è®¡ç®—æœºè§†è§‰æŠ€æœ¯ä»¥æå‡æ£€æµ‹çš„æ™ºèƒ½åŒ–æ°´å¹³ã€‚è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯åœ¨å›¾åƒè¯†åˆ«å’Œç›®æ ‡æ£€æµ‹é¢†åŸŸå–å¾—äº†æ˜¾è‘—è¿›å±•ï¼Œå°¤å…¶æ˜¯YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹å› å…¶é«˜æ•ˆçš„å®æ—¶æ£€æµ‹èƒ½åŠ›è€Œå—åˆ°å¹¿æ³›å…³æ³¨ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå…·å¤‡æ›´å¼ºçš„ç‰¹å¾æå–èƒ½åŠ›å’Œæ›´å¿«çš„æ¨ç†é€Ÿåº¦ï¼Œä¸ºç„Šæ¥ç¼ºé™·æ£€æµ‹æä¾›äº†æ–°çš„å¯èƒ½æ€§ã€‚

åœ¨ç„Šæ¥è¿‡ç¨‹ä¸­ï¼Œå¸¸è§çš„ç¼ºé™·åŒ…æ‹¬æ°”å­”ã€å¤¹æ¸£å’Œç„Šç¼ä¸å‡ç­‰ï¼Œè¿™äº›ç¼ºé™·ä¸ä»…å½±å“ç„Šæ¥æ¥å¤´çš„åŠ›å­¦æ€§èƒ½ï¼Œè¿˜å¯èƒ½å¯¼è‡´ç»“æ„å¤±æ•ˆã€‚å› æ­¤ï¼ŒåŠæ—¶ã€å‡†ç¡®åœ°æ£€æµ‹ç„Šæ¥ç¼ºé™·å¯¹äºä¿éšœäº§å“è´¨é‡è‡³å…³é‡è¦ã€‚ä¼ ç»Ÿçš„äººå·¥æ£€æµ‹æ–¹æ³•ä¸ä»…è€—æ—¶è€—åŠ›ï¼Œè€Œä¸”å®¹æ˜“å—åˆ°äººä¸ºå› ç´ çš„å½±å“ï¼Œå¯¼è‡´æ¼æ£€æˆ–è¯¯æ£€ç°è±¡çš„å‘ç”Ÿã€‚åŸºäºæ·±åº¦å­¦ä¹ çš„è‡ªåŠ¨åŒ–æ£€æµ‹ç³»ç»Ÿèƒ½å¤Ÿé€šè¿‡å¤§é‡æ•°æ®çš„å­¦ä¹ ï¼Œè‡ªåŠ¨è¯†åˆ«å’Œåˆ†ç±»ç„Šæ¥ç¼ºé™·ï¼Œæ˜¾è‘—æé«˜æ£€æµ‹æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚

æœ¬ç ”ç©¶åŸºäºæ”¹è¿›çš„YOLOv8æ¨¡å‹ï¼Œæ„å»ºäº†ä¸€å¥—ç„Šæ¥ç¼ºé™·æ£€æµ‹ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿåˆ©ç”¨ä¸€ä¸ªåŒ…å«2500å¼ å›¾åƒçš„æ•°æ®é›†ï¼Œæ¶µç›–äº†ä¸‰ç±»ç„Šæ¥ç¼ºé™·ï¼šOSOï¼ˆæ°”å­”ï¼‰ã€TEEï¼ˆå¤¹æ¸£ï¼‰å’ŒWELDï¼ˆç„Šç¼ä¸å‡ï¼‰ã€‚é€šè¿‡å¯¹è¿™äº›å›¾åƒçš„æ·±åº¦å­¦ä¹ è®­ç»ƒï¼Œç³»ç»Ÿèƒ½å¤Ÿåœ¨å¤æ‚çš„ç„Šæ¥ç¯å¢ƒä¸­å¿«é€Ÿã€å‡†ç¡®åœ°è¯†åˆ«å’Œåˆ†ç±»ä¸åŒç±»å‹çš„ç¼ºé™·ã€‚è¿™ä¸ä»…ä¸ºç„Šæ¥è´¨é‡æ§åˆ¶æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æŒï¼Œä¹Ÿä¸ºåç»­çš„æ™ºèƒ½åˆ¶é€ å’Œå·¥ä¸š4.0çš„å‘å±•å¥ å®šäº†åŸºç¡€ã€‚

æ­¤å¤–ï¼Œéšç€æ•°æ®é›†çš„ä¸æ–­æ‰©å±•å’Œæ¨¡å‹çš„ä¸æ–­ä¼˜åŒ–ï¼ŒåŸºäºYOLOv8çš„ç„Šæ¥ç¼ºé™·æ£€æµ‹ç³»ç»Ÿæœ‰æœ›åœ¨æœªæ¥å®ç°æ›´é«˜çš„æ£€æµ‹ç²¾åº¦å’Œæ›´å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä¸å…¶ä»–ä¼ æ„Ÿå™¨æŠ€æœ¯çš„ç»“åˆï¼Œå¦‚çº¢å¤–æˆåƒã€è¶…å£°æ³¢æ£€æµ‹ç­‰ï¼Œå½¢æˆå¤šæ¨¡æ€æ£€æµ‹ç³»ç»Ÿï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡ç„Šæ¥ç¼ºé™·æ£€æµ‹çš„å…¨é¢æ€§å’Œå¯é æ€§ã€‚è¿™ä¸€ç ”ç©¶ä¸ä»…æ¨åŠ¨äº†ç„Šæ¥é¢†åŸŸçš„æŠ€æœ¯è¿›æ­¥ï¼Œä¹Ÿä¸ºå…¶ä»–å·¥ä¸šæ£€æµ‹é¢†åŸŸæä¾›äº†å€Ÿé‰´ï¼Œå…·æœ‰é‡è¦çš„å­¦æœ¯ä»·å€¼å’Œåº”ç”¨å‰æ™¯ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„ç„Šæ¥ç¼ºé™·æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å“åº”äº†å·¥ä¸šè‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åˆ¶é€ çš„æ—¶ä»£éœ€æ±‚ï¼Œä¹Ÿä¸ºç„Šæ¥è´¨é‡æ§åˆ¶æä¾›äº†æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå…·æœ‰é‡è¦çš„ç†è®ºæ„ä¹‰å’Œå®é™…åº”ç”¨ä»·å€¼ã€‚é€šè¿‡æ·±å…¥æ¢ç´¢æ·±åº¦å­¦ä¹ åœ¨ç„Šæ¥ç¼ºé™·æ£€æµ‹ä¸­çš„åº”ç”¨ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿæ¨åŠ¨ç„Šæ¥æŠ€æœ¯çš„è¿›æ­¥ï¼Œæå‡åˆ¶é€ ä¸šçš„æ•´ä½“æ°´å¹³ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1yZ4ZeYELd/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 3
names: ['OSO', 'TEE', 'WELD']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨ç„Šæ¥ç¼ºé™·æ£€æµ‹é¢†åŸŸï¼Œæ•°æ®é›†çš„æ„å»ºä¸åº”ç”¨è‡³å…³é‡è¦ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†åä¸ºâ€œCQDYKâ€çš„æ•°æ®é›†ï¼Œä¸“é—¨ç”¨äºè®­ç»ƒå’Œæ”¹è¿›YOLOv8æ¨¡å‹ï¼Œä»¥å®ç°é«˜æ•ˆã€å‡†ç¡®çš„ç„Šæ¥ç¼ºé™·æ£€æµ‹ã€‚è¯¥æ•°æ®é›†çš„è®¾è®¡æ—¨åœ¨æ¶µç›–ç„Šæ¥è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„ä¸»è¦ç¼ºé™·ç±»å‹ï¼Œè¿›è€Œæå‡è‡ªåŠ¨åŒ–æ£€æµ‹ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯é æ€§ã€‚

â€œCQDYKâ€æ•°æ®é›†åŒ…å«ä¸‰ç§ä¸»è¦ç±»åˆ«ï¼Œåˆ†åˆ«ä¸ºâ€œOSOâ€ï¼ˆå¼€å£ç„Šç¼ï¼‰ã€â€œTEEâ€ï¼ˆTå‹ç„Šç¼ï¼‰å’Œâ€œWELDâ€ï¼ˆç„Šæ¥æ¥å¤´ï¼‰ã€‚è¿™ä¸‰ç§ç±»åˆ«ä»£è¡¨äº†ç„Šæ¥å·¥è‰ºä¸­å¸¸è§çš„ç¼ºé™·ç±»å‹ï¼Œå…·æœ‰é‡è¦çš„å®ç”¨ä»·å€¼ã€‚å¼€å£ç„Šç¼é€šå¸¸æŒ‡çš„æ˜¯ç„Šæ¥è¿‡ç¨‹ä¸­æœªèƒ½å®Œå…¨å¡«å……çš„åŒºåŸŸï¼Œå¯èƒ½å¯¼è‡´ç»“æ„å¼ºåº¦ä¸è¶³ï¼›Tå‹ç„Šç¼åˆ™æ˜¯æŒ‡åœ¨äº¤å‰ç„Šæ¥ç‚¹å¯èƒ½å‡ºç°çš„ç¼ºé™·ï¼Œå½±å“è¿æ¥çš„ç¨³å›ºæ€§ï¼›è€Œç„Šæ¥æ¥å¤´åˆ™æ˜¯ç„Šæ¥çš„å…³é”®éƒ¨ä½ï¼Œä»»ä½•ç¼ºé™·éƒ½å¯èƒ½å¯¹æ•´ä½“ç»“æ„çš„å®‰å…¨æ€§é€ æˆå¨èƒã€‚å› æ­¤ï¼Œå‡†ç¡®è¯†åˆ«å’Œåˆ†ç±»è¿™äº›ç¼ºé™·å¯¹äºç¡®ä¿ç„Šæ¥è´¨é‡å’Œç»“æ„å®‰å…¨è‡³å…³é‡è¦ã€‚

æ•°æ®é›†â€œCQDYKâ€çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œé‡‡é›†äº†å¤§é‡çœŸå®ç„Šæ¥åœºæ™¯ä¸‹çš„å›¾åƒæ•°æ®ï¼Œç¡®ä¿æ•°æ®çš„å¤šæ ·æ€§å’Œä»£è¡¨æ€§ã€‚è¿™äº›å›¾åƒä¸ä»…æ¶µç›–äº†ä¸åŒç±»å‹çš„ç„Šæ¥ç¼ºé™·ï¼Œè¿˜åŒ…æ‹¬äº†ä¸åŒçš„ç„Šæ¥ææ–™ã€å·¥è‰ºå‚æ•°å’Œç¯å¢ƒæ¡ä»¶ã€‚è¿™ç§å¤šæ ·æ€§ä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿå­¦ä¹ åˆ°æ›´ä¸ºä¸°å¯Œçš„ç‰¹å¾ï¼Œä»è€Œåœ¨å®é™…åº”ç”¨ä¸­è¡¨ç°å‡ºæ›´å¼ºçš„æ³›åŒ–èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†ä¸­çš„æ¯ä¸€å¼ å›¾åƒéƒ½ç»è¿‡ç²¾ç¡®æ ‡æ³¨ï¼Œç¡®ä¿æ¯ä¸ªç¼ºé™·çš„ç±»åˆ«å’Œä½ç½®éƒ½èƒ½è¢«å‡†ç¡®è¯†åˆ«ï¼Œä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†åšå®çš„åŸºç¡€ã€‚

åœ¨æ•°æ®é›†çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œç ”ç©¶äººå‘˜å°†â€œCQDYKâ€ä¸YOLOv8æ¨¡å‹ç›¸ç»“åˆï¼Œåˆ©ç”¨å…¶å…ˆè¿›çš„æ·±åº¦å­¦ä¹ ç®—æ³•è¿›è¡Œç„Šæ¥ç¼ºé™·çš„æ£€æµ‹ä¸åˆ†ç±»ã€‚YOLOv8ä½œä¸ºä¸€ç§é«˜æ•ˆçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œèƒ½å¤Ÿåœ¨ä¿è¯æ£€æµ‹ç²¾åº¦çš„åŒæ—¶ï¼Œæ˜¾è‘—æé«˜æ£€æµ‹é€Ÿåº¦ï¼Œé€‚ç”¨äºå®æ—¶ç›‘æ§å’Œå·¥ä¸šåº”ç”¨åœºæ™¯ã€‚é€šè¿‡å¯¹â€œCQDYKâ€æ•°æ®é›†çš„è®­ç»ƒï¼Œæ¨¡å‹èƒ½å¤Ÿåœ¨å¤æ‚çš„ç„Šæ¥ç¯å¢ƒä¸­å¿«é€Ÿã€å‡†ç¡®åœ°è¯†åˆ«å‡ºä¸åŒç±»å‹çš„ç„Šæ¥ç¼ºé™·ï¼Œæå¤§åœ°æé«˜äº†ç„Šæ¥è´¨é‡æ£€æµ‹çš„æ•ˆç‡ã€‚

æ­¤å¤–ï¼Œä¸ºäº†è¿›ä¸€æ­¥æå‡æ¨¡å‹çš„æ€§èƒ½ï¼Œç ”ç©¶å›¢é˜Ÿè¿˜å¯¹æ•°æ®é›†è¿›è¡Œäº†æ•°æ®å¢å¼ºå¤„ç†ï¼ŒåŒ…æ‹¬æ—‹è½¬ã€ç¼©æ”¾ã€è£å‰ªç­‰æ“ä½œï¼Œä»¥å¢åŠ æ¨¡å‹çš„é²æ£’æ€§ã€‚è¿™äº›æŠ€æœ¯æ‰‹æ®µä¸ä»…ä¸°å¯Œäº†è®­ç»ƒæ•°æ®çš„å¤šæ ·æ€§ï¼Œè¿˜æœ‰æ•ˆé˜²æ­¢äº†æ¨¡å‹çš„è¿‡æ‹Ÿåˆç°è±¡ï¼Œä½¿å¾—æœ€ç»ˆçš„æ£€æµ‹ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¤æ‚æƒ…å†µæ—¶ä¾ç„¶èƒ½å¤Ÿä¿æŒé«˜æ°´å¹³çš„æ£€æµ‹å‡†ç¡®ç‡ã€‚

æ€»ä¹‹ï¼Œâ€œCQDYKâ€æ•°æ®é›†ä¸ºç„Šæ¥ç¼ºé™·æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ä¸å¼€å‘æä¾›äº†é‡è¦çš„æ”¯æŒã€‚é€šè¿‡ä¸YOLOv8æ¨¡å‹çš„ç»“åˆï¼Œç ”ç©¶äººå‘˜èƒ½å¤Ÿåœ¨ç„Šæ¥è´¨é‡æ§åˆ¶é¢†åŸŸå®ç°æ›´é«˜æ•ˆã€æ›´æ™ºèƒ½çš„æ£€æµ‹è§£å†³æ–¹æ¡ˆï¼Œä¸ºå·¥ä¸šç”Ÿäº§çš„å®‰å…¨æ€§å’Œå¯é æ€§æä¾›äº†åšå®ä¿éšœã€‚æœªæ¥ï¼Œéšç€æ•°æ®é›†çš„ä¸æ–­æ‰©å±•å’Œæ¨¡å‹çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡ç„Šæ¥ç¼ºé™·æ£€æµ‹æŠ€æœ¯å°†è¿æ¥æ›´ä¸ºå¹¿é˜”çš„å‘å±•å‰æ™¯ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOv8æ¨¡å‹æ˜¯ç”±Ultralyticså›¢é˜Ÿåœ¨YOLOv5çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€ç³»åˆ—åˆ›æ–°å’Œæ”¹è¿›åæ¨å‡ºçš„æœ€æ–°ç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚è‡ª2023å¹´1æœˆå‘å¸ƒä»¥æ¥ï¼ŒYOLOv8å‡­å€Ÿå…¶åœ¨ç²¾åº¦å’Œé€Ÿåº¦ä¸Šçš„æ˜¾è‘—æå‡ï¼Œè¿…é€Ÿæˆä¸ºç›®æ ‡æ£€æµ‹é¢†åŸŸçš„ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ã€‚YOLOv8çš„è®¾è®¡ç†å¿µæ˜¯å°†æ·±åº¦å­¦ä¹ çš„æœ€æ–°ç ”ç©¶æˆæœä¸å®é™…åº”ç”¨éœ€æ±‚ç›¸ç»“åˆï¼Œä»¥å®ç°æ›´é«˜æ•ˆçš„ç›®æ ‡æ£€æµ‹ã€‚

åœ¨YOLOv8çš„ç½‘ç»œç»“æ„ä¸­ï¼Œä¸»è¦åˆ†ä¸ºè¾“å…¥å±‚ã€ä¸»å¹²ç½‘ç»œã€é¢ˆéƒ¨ç½‘ç»œå’Œå¤´éƒ¨ç½‘ç»œå››ä¸ªéƒ¨åˆ†ã€‚è¾“å…¥å±‚è´Ÿè´£å¯¹è¾“å…¥å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å›¾åƒç¼©æ”¾ã€æ•°æ®å¢å¼ºç­‰æ“ä½œã€‚YOLOv8åœ¨æ•°æ®å¢å¼ºæ–¹é¢åšå‡ºäº†åˆ›æ–°ï¼Œç‰¹åˆ«æ˜¯å¯¹Mosaicæ•°æ®å¢å¼ºçš„ä½¿ç”¨è¿›è¡Œäº†ä¼˜åŒ–ã€‚è™½ç„¶Mosaicå¢å¼ºåœ¨æå‡æ¨¡å‹é²æ£’æ€§å’Œæ³›åŒ–èƒ½åŠ›æ–¹é¢è¡¨ç°è‰¯å¥½ï¼Œä½†è¿‡åº¦ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹å­¦ä¹ åˆ°ä¸çœŸå®çš„ç‰¹å¾ã€‚å› æ­¤ï¼ŒYOLOv8åœ¨è®­ç»ƒçš„æœ€å10ä¸ªepochä¸­åœæ­¢ä½¿ç”¨Mosaicå¢å¼ºï¼Œä»¥ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰çœŸå®æ•°æ®çš„åˆ†å¸ƒã€‚

ä¸»å¹²ç½‘ç»œæ˜¯YOLOv8çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡å·ç§¯æ“ä½œæå–å›¾åƒç‰¹å¾ã€‚ä¸YOLOv5ç›¸æ¯”ï¼ŒYOLOv8åœ¨ä¸»å¹²ç½‘ç»œä¸­å°†C3æ¨¡å—æ›¿æ¢ä¸ºC2fæ¨¡å—ã€‚C2fæ¨¡å—å¼•å…¥äº†YOLOv7ä¸­çš„ELANæ€æƒ³ï¼Œé€šè¿‡å¢åŠ è·³å±‚è¿æ¥æ¥å¢å¼ºæ¢¯åº¦æµï¼Œè¿™ä¸ä»…æé«˜äº†ç‰¹å¾æå–çš„æ•ˆç‡ï¼Œè¿˜ä½¿å¾—æ¨¡å‹çš„è½»é‡åŒ–å¾—ä»¥å®ç°ã€‚SPPFï¼ˆSpatial Pyramid Pooling Fusionï¼‰æ¨¡å—ä¾ç„¶ä¿ç•™åœ¨ä¸»å¹²ç½‘ç»œä¸­ï¼Œç»§ç»­å‘æŒ¥å…¶åœ¨å¤šå°ºåº¦ç‰¹å¾å¤„ç†ä¸­çš„ä½œç”¨ï¼ŒåŒæ—¶å‡å°‘äº†æ‰§è¡Œæ—¶é—´ï¼Œæå‡äº†æ•´ä½“æ€§èƒ½ã€‚

é¢ˆéƒ¨ç½‘ç»œåˆ™é‡‡ç”¨äº†è·¯å¾„èšåˆç½‘ç»œï¼ˆPANï¼‰ç»“æ„ï¼Œæ—¨åœ¨æœ‰æ•ˆèåˆä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ä¿¡æ¯ã€‚YOLOv8åœ¨é¢ˆéƒ¨ç½‘ç»œä¸­ä¹Ÿå°†æ‰€æœ‰çš„C3æ¨¡å—æ›¿æ¢ä¸ºC2fæ¨¡å—ï¼Œå¹¶åˆ é™¤äº†ä¸Šé‡‡æ ·ä¹‹å‰çš„å·ç§¯è¿æ¥å±‚ï¼Œä»¥è¿›ä¸€æ­¥ç®€åŒ–ç½‘ç»œç»“æ„ï¼Œæå‡ä¿¡æ¯ä¼ é€’çš„æ•ˆç‡ã€‚è¿™ç§è®¾è®¡ä½¿å¾—YOLOv8èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†å„ç§å°ºåº¦çš„ç›®æ ‡ï¼Œæé«˜äº†å¯¹å°ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚

åœ¨å¤´éƒ¨ç½‘ç»œä¸­ï¼ŒYOLOv8é‡‡ç”¨äº†è§£è€¦çš„æ£€æµ‹å¤´ç»“æ„ï¼Œåˆ†åˆ«å¤„ç†åˆ†ç±»å’Œå›å½’ä»»åŠ¡ã€‚å…·ä½“è€Œè¨€ï¼ŒYOLOv8é€šè¿‡ä¸¤ä¸ªå¹¶è¡Œçš„å·ç§¯åˆ†æ”¯æ¥æå–ç±»åˆ«å’Œä½ç½®ç‰¹å¾ã€‚åˆ†ç±»ä»»åŠ¡ä¾§é‡äºåˆ†æç‰¹å¾å›¾ä¸­æå–åˆ°çš„ç‰¹å¾ä¸å·²çŸ¥ç±»åˆ«çš„ç›¸ä¼¼æ€§ï¼Œè€Œå®šä½ä»»åŠ¡åˆ™å…³æ³¨è¾¹ç•Œæ¡†ä¸çœŸå®æ¡†ä¹‹é—´çš„å…³ç³»ã€‚è¿™ç§è§£è€¦è®¾è®¡ä¸ä»…æé«˜äº†æ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦ï¼Œè¿˜æå‡äº†é¢„æµ‹çš„ç²¾åº¦ã€‚æ­¤å¤–ï¼ŒYOLOv8é‡‡ç”¨äº†æ— é”šæ¡†ç»“æ„ï¼Œç›´æ¥é¢„æµ‹ç›®æ ‡çš„ä¸­å¿ƒä½ç½®ï¼Œå¹¶å¼•å…¥äº†ä»»åŠ¡å¯¹é½å­¦ä¹ ï¼ˆTask Alignment Learningï¼ŒTALï¼‰æœºåˆ¶ï¼Œä»¥æ›´å¥½åœ°åŒºåˆ†æ­£è´Ÿæ ·æœ¬ã€‚é€šè¿‡å¼•å…¥åˆ†ç±»åˆ†æ•°å’ŒIOUçš„é«˜æ¬¡å¹‚ä¹˜ç§¯ä½œä¸ºä»»åŠ¡å¯¹é½ç¨‹åº¦çš„æŒ‡æ ‡ï¼ŒYOLOv8åœ¨åˆ†ç±»å’Œå®šä½æŸå¤±å‡½æ•°ä¸­éƒ½è€ƒè™‘äº†è¿™ä¸€æŒ‡æ ‡ï¼Œä»è€Œå®ç°äº†æ›´å¥½çš„å®šä½å’Œåˆ†ç±»æ€§èƒ½ã€‚

åœ¨æ¨¡å‹çš„æ£€æµ‹æ•ˆæœä¸Šï¼ŒYOLOv8åœ¨COCOæ•°æ®é›†ä¸Šçš„è¡¨ç°ä¹Ÿä»¤äººç©ç›®ã€‚é€šè¿‡å¯¹æ¯”ä¸åŒå°ºå¯¸çš„æ¨¡å‹ï¼ŒYOLOv8åœ¨ä¿æŒå‚æ•°é‡ç›¸å¯¹ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œå–å¾—äº†æ›´é«˜çš„ç²¾åº¦ã€‚åŒæ—¶ï¼ŒYOLOv8åœ¨æ¨ç†é€Ÿåº¦ä¸Šä¹Ÿè¡¨ç°å‡ºè‰²ï¼Œè¾ƒå…¶ä»–YOLOç³»åˆ—æ¨¡å‹åœ¨åŒå°ºå¯¸ä¸‹å®ç°äº†æ›´å¿«çš„æ¨ç†é€Ÿåº¦ï¼Œä¸”ç²¾åº¦æŸå¤±å¾®ä¹å…¶å¾®ã€‚è¿™ä½¿å¾—YOLOv8åœ¨å®æ—¶æ€§å’Œå‡†ç¡®æ€§ä¹‹é—´æ‰¾åˆ°äº†è‰¯å¥½çš„å¹³è¡¡ï¼Œå°¤å…¶é€‚åˆäºéœ€è¦å¿«é€Ÿå“åº”çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚è‡ªåŠ¨é©¾é©¶ã€å®‰é˜²ç›‘æ§ç­‰ã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8æ¨¡å‹åœ¨å¤šä¸ªæ–¹é¢è¿›è¡Œäº†åˆ›æ–°å’Œä¼˜åŒ–ï¼Œä½¿å…¶åœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­å±•ç°å‡ºä¼˜è¶Šçš„æ€§èƒ½ã€‚å…¶ç»“æ„è®¾è®¡å……åˆ†è€ƒè™‘äº†æ¨¡å‹çš„è½»é‡åŒ–å’Œé«˜æ•ˆæ€§ï¼Œé€‚åº”äº†ç°ä»£è®¡ç®—å¹³å°çš„éœ€æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡å’Œè¾¹ç¼˜è®¡ç®—ç¯å¢ƒä¸­ã€‚éšç€YOLOv8çš„æ¨å¹¿å’Œåº”ç”¨ï¼Œæœªæ¥åœ¨åƒåœ¾ç›®æ ‡æ£€æµ‹ã€æ™ºèƒ½ç›‘æ§ç­‰é¢†åŸŸçš„åº”ç”¨æ½œåŠ›å°†æ›´åŠ å¹¿é˜”ã€‚YOLOv8ä¸ä»…æ˜¯YOLOç³»åˆ—æ¨¡å‹çš„åˆä¸€æ¬¡é£è·ƒï¼Œæ›´æ˜¯ç›®æ ‡æ£€æµ‹æŠ€æœ¯å‘å±•çš„é‡è¦é‡Œç¨‹ç¢‘ï¼Œå±•ç°äº†æ·±åº¦å­¦ä¹ åœ¨å®é™…åº”ç”¨ä¸­çš„å·¨å¤§æ½œåŠ›å’Œä»·å€¼ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 code\ultralytics\data\explorer\explorer.py

ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œçš„åˆ†æå’Œè¯¦ç»†æ³¨é‡Šï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license

from io import BytesIO
from pathlib import Path
from typing import Any, List, Tuple, Union

import cv2
import numpy as np
import torch
from PIL import Image
from matplotlib import pyplot as plt
from pandas import DataFrame
from tqdm import tqdm

from ultralytics.data.augment import Format
from ultralytics.data.dataset import YOLODataset
from ultralytics.data.utils import check_det_dataset
from ultralytics.models.yolo.model import YOLO
from ultralytics.utils import LOGGER, IterableSimpleNamespace, checks

class ExplorerDataset(YOLODataset):
    def __init__(self, *args, data: dict = None, **kwargs) -> None:
        # åˆå§‹åŒ–ExplorerDatasetï¼Œè°ƒç”¨çˆ¶ç±»YOLODatasetçš„æ„é€ å‡½æ•°
        super().__init__(*args, data=data, **kwargs)

    def load_image(self, i: int) -> Union[Tuple[np.ndarray, Tuple[int, int], Tuple[int, int]], Tuple[None, None, None]]:
        """ä»æ•°æ®é›†ä¸­åŠ è½½ç´¢å¼•ä¸º'i'çš„å›¾åƒï¼Œä¸è¿›è¡Œä»»ä½•è°ƒæ•´å¤§å°æ“ä½œã€‚"""
        im, f, fn = self.ims[i], self.im_files[i], self.npy_files[i]
        if im is None:  # å¦‚æœå›¾åƒæœªç¼“å­˜åˆ°å†…å­˜ä¸­
            if fn.exists():  # å¦‚æœå­˜åœ¨npyæ–‡ä»¶ï¼ŒåŠ è½½npyæ–‡ä»¶
                im = np.load(fn)
            else:  # å¦åˆ™è¯»å–å›¾åƒæ–‡ä»¶
                im = cv2.imread(f)  # è¯»å–ä¸ºBGRæ ¼å¼
                if im is None:
                    raise FileNotFoundError(f"Image Not Found {f}")  # å¦‚æœå›¾åƒæœªæ‰¾åˆ°ï¼ŒæŠ›å‡ºå¼‚å¸¸
            h0, w0 = im.shape[:2]  # è·å–åŸå§‹é«˜åº¦å’Œå®½åº¦
            return im, (h0, w0), im.shape[:2]  # è¿”å›å›¾åƒåŠå…¶å°ºå¯¸ä¿¡æ¯

        return self.ims[i], self.im_hw0[i], self.im_hw[i]  # è¿”å›ç¼“å­˜çš„å›¾åƒå’Œå°ºå¯¸ä¿¡æ¯

    def build_transforms(self, hyp: IterableSimpleNamespace = None):
        """åˆ›å»ºæ•°æ®é›†å›¾åƒçš„è½¬æ¢ï¼Œä¸è¿›è¡Œè°ƒæ•´å¤§å°ã€‚"""
        return Format(
            bbox_format="xyxy",  # è¾¹ç•Œæ¡†æ ¼å¼
            normalize=False,  # ä¸è¿›è¡Œå½’ä¸€åŒ–
            return_mask=self.use_segments,  # æ˜¯å¦è¿”å›åˆ†å‰²æ©ç 
            return_keypoint=self.use_keypoints,  # æ˜¯å¦è¿”å›å…³é”®ç‚¹
            batch_idx=True,  # è¿”å›æ‰¹æ¬¡ç´¢å¼•
            mask_ratio=hyp.mask_ratio,  # æ©ç æ¯”ä¾‹
            mask_overlap=hyp.overlap_mask,  # æ©ç é‡å 
        )

class Explorer:
    def __init__(self, data: Union[str, Path] = "coco128.yaml", model: str = "yolov8n.pt", uri: str = "~/ultralytics/explorer") -> None:
        # æ£€æŸ¥æ‰€éœ€çš„åº“æ˜¯å¦å®‰è£…
        checks.check_requirements(["lancedb>=0.4.3", "duckdb"])
        import lancedb

        self.connection = lancedb.connect(uri)  # è¿æ¥åˆ°LanceDB
        self.table_name = Path(data).name.lower() + "_" + model.lower()  # ç”Ÿæˆè¡¨å
        self.sim_idx_base_name = f"{self.table_name}_sim_idx".lower()  # ç›¸ä¼¼ç´¢å¼•çš„åŸºæœ¬åç§°
        self.model = YOLO(model)  # åŠ è½½YOLOæ¨¡å‹
        self.data = data  # æ•°æ®é›†è·¯å¾„
        self.choice_set = None  # é€‰æ‹©çš„æ•°æ®é›†
        self.table = None  # æ•°æ®è¡¨
        self.progress = 0  # è¿›åº¦

    def create_embeddings_table(self, force: bool = False, split: str = "train") -> None:
        """
        åˆ›å»ºåŒ…å«æ•°æ®é›†ä¸­å›¾åƒåµŒå…¥çš„LanceDBè¡¨ã€‚å¦‚æœè¡¨å·²å­˜åœ¨ï¼Œåˆ™é‡ç”¨è¯¥è¡¨ã€‚
        """
        if self.table is not None and not force:
            LOGGER.info("Table already exists. Reusing it. Pass force=True to overwrite it.")
            return
        if self.table_name in self.connection.table_names() and not force:
            LOGGER.info(f"Table {self.table_name} already exists. Reusing it. Pass force=True to overwrite it.")
            self.table = self.connection.open_table(self.table_name)
            self.progress = 1
            return
        if self.data is None:
            raise ValueError("Data must be provided to create embeddings table")

        data_info = check_det_dataset(self.data)  # æ£€æŸ¥æ•°æ®é›†ä¿¡æ¯
        if split not in data_info:
            raise ValueError(f"Split {split} is not found in the dataset. Available keys in the dataset are {list(data_info.keys())}")

        choice_set = data_info[split]  # è·å–æŒ‡å®šåˆ†å‰²çš„æ•°æ®é›†
        choice_set = choice_set if isinstance(choice_set, list) else [choice_set]
        self.choice_set = choice_set
        dataset = ExplorerDataset(img_path=choice_set, data=data_info, augment=False, cache=False, task=self.model.task)

        # åˆ›å»ºè¡¨æ¨¡å¼
        batch = dataset[0]
        vector_size = self.model.embed(batch["im_file"], verbose=False)[0].shape[0]  # è·å–åµŒå…¥å‘é‡çš„ç»´åº¦
        table = self.connection.create_table(self.table_name, schema=get_table_schema(vector_size), mode="overwrite")  # åˆ›å»ºè¡¨
        table.add(
            self._yield_batches(
                dataset,
                data_info,
                self.model,
                exclude_keys=["img", "ratio_pad", "resized_shape", "ori_shape", "batch_idx"],
            )
        )

        self.table = table  # ä¿å­˜è¡¨çš„å¼•ç”¨

    def _yield_batches(self, dataset: ExplorerDataset, data_info: dict, model: YOLO, exclude_keys: List[str]):
        """ç”Ÿæˆç”¨äºåµŒå…¥çš„æ•°æ®æ‰¹æ¬¡ï¼Œæ’é™¤æŒ‡å®šçš„é”®ã€‚"""
        for i in tqdm(range(len(dataset))):
            self.progress = float(i + 1) / len(dataset)  # æ›´æ–°è¿›åº¦
            batch = dataset[i]
            for k in exclude_keys:
                batch.pop(k, None)  # ç§»é™¤ä¸éœ€è¦çš„é”®
            batch = sanitize_batch(batch, data_info)  # æ¸…ç†æ‰¹æ¬¡æ•°æ®
            batch["vector"] = model.embed(batch["im_file"], verbose=False)[0].detach().tolist()  # è®¡ç®—åµŒå…¥å‘é‡
            yield [batch]  # ç”Ÿæˆæ‰¹æ¬¡

    def query(self, imgs: Union[str, np.ndarray, List[str], List[np.ndarray]] = None, limit: int = 25) -> Any:
        """
        æŸ¥è¯¢è¡¨ä»¥è·å–ç›¸ä¼¼å›¾åƒã€‚æ¥å—å•ä¸ªå›¾åƒæˆ–å›¾åƒåˆ—è¡¨ã€‚
        """
        if self.table is None:
            raise ValueError("Table is not created. Please create the table first.")
        if isinstance(imgs, str):
            imgs = [imgs]  # å¦‚æœæ˜¯å•ä¸ªå›¾åƒè·¯å¾„ï¼Œè½¬æ¢ä¸ºåˆ—è¡¨
        assert isinstance(imgs, list), f"img must be a string or a list of strings. Got {type(imgs)}"
        embeds = self.model.embed(imgs)  # è®¡ç®—å›¾åƒçš„åµŒå…¥å‘é‡
        embeds = torch.mean(torch.stack(embeds), 0).cpu().numpy() if len(embeds) > 1 else embeds[0].cpu().numpy()  # å¦‚æœæœ‰å¤šä¸ªå›¾åƒï¼Œå–å¹³å‡
        return self.table.search(embeds).limit(limit).to_arrow()  # æŸ¥è¯¢ç›¸ä¼¼å›¾åƒå¹¶è¿”å›ç»“æœ

    def sql_query(self, query: str, return_type: str = "pandas") -> Union[DataFrame, Any, None]:
        """
        åœ¨è¡¨ä¸Šè¿è¡ŒSQLæŸ¥è¯¢ã€‚åˆ©ç”¨LanceDBçš„è°“è¯ä¸‹æ¨ã€‚
        """
        assert return_type in {"pandas", "arrow"}, f"Return type should be either `pandas` or `arrow`, but got {return_type}"
        import duckdb

        if self.table is None:
            raise ValueError("Table is not created. Please create the table first.")

        table = self.table.to_arrow()  # å°†è¡¨è½¬æ¢ä¸ºArrowæ ¼å¼
        if not query.startswith("SELECT") and not query.startswith("WHERE"):
            raise ValueError(f"Query must start with SELECT or WHERE. You can either pass the entire query or just the WHERE clause. found {query}")
        if query.startswith("WHERE"):
            query = f"SELECT * FROM 'table' {query}"  # å¦‚æœæŸ¥è¯¢ä»¥WHEREå¼€å¤´ï¼Œè¡¥å…¨ä¸ºSELECTè¯­å¥
        LOGGER.info(f"Running query: {query}")

        rs = duckdb.sql(query)  # æ‰§è¡ŒæŸ¥è¯¢
        if return_type == "arrow":
            return rs.arrow()  # è¿”å›Arrowæ ¼å¼ç»“æœ
        elif return_type == "pandas":
            return rs.df()  # è¿”å›Pandas DataFrameæ ¼å¼ç»“æœ

    def plot_sql_query(self, query: str, labels: bool = True) -> Image.Image:
        """
        ç»˜åˆ¶SQLæŸ¥è¯¢ç»“æœçš„å›¾åƒã€‚
        """
        result = self.sql_query(query, return_type="arrow")
        if len(result) == 0:
            LOGGER.info("No results found.")
            return None
        img = plot_query_result(result, plot_labels=labels)  # ç»˜åˆ¶æŸ¥è¯¢ç»“æœ
        return Image.fromarray(img)  # è¿”å›å›¾åƒ

    def get_similar(self, img: Union[str, np.ndarray, List[str], List[np.ndarray]] = None, idx: Union[int, List[int]] = None, limit: int = 25, return_type: str = "pandas") -> Union[DataFrame, Any]:
        """
        æŸ¥è¯¢è¡¨ä»¥è·å–ç›¸ä¼¼å›¾åƒã€‚æ¥å—å•ä¸ªå›¾åƒæˆ–å›¾åƒåˆ—è¡¨ã€‚
        """
        assert return_type in {"pandas", "arrow"}, f"Return type should be either `pandas` or `arrow`, but got {return_type}"
        img = self._check_imgs_or_idxs(img, idx)  # æ£€æŸ¥å›¾åƒæˆ–ç´¢å¼•
        similar = self.query(img, limit=limit)  # æŸ¥è¯¢ç›¸ä¼¼å›¾åƒ

        if return_type == "arrow":
            return similar
        elif return_type == "pandas":
            return similar.to_pandas()  # è¿”å›Pandas DataFrameæ ¼å¼ç»“æœ

    def plot_similar(self, img: Union[str, np.ndarray, List[str], List[np.ndarray]] = None, idx: Union[int, List[int]] = None, limit: int = 25, labels: bool = True) -> Image.Image:
        """
        ç»˜åˆ¶ç›¸ä¼¼å›¾åƒã€‚æ¥å—å›¾åƒæˆ–ç´¢å¼•ã€‚
        """
        similar = self.get_similar(img, idx, limit, return_type="arrow")
        if len(similar) == 0:
            LOGGER.info("No results found.")
            return None
        img = plot_query_result(similar, plot_labels=labels)  # ç»˜åˆ¶ç›¸ä¼¼å›¾åƒ
        return Image.fromarray(img)  # è¿”å›å›¾åƒ

    def similarity_index(self, max_dist: float = 0.2, top_k: float = None, force: bool = False) -> DataFrame:
        """
        è®¡ç®—è¡¨ä¸­æ‰€æœ‰å›¾åƒçš„ç›¸ä¼¼æ€§ç´¢å¼•ã€‚
        """
        if self.table is None:
            raise ValueError("Table is not created. Please create the table first.")
        sim_idx_table_name = f"{self.sim_idx_base_name}_thres_{max_dist}_top_{top_k}".lower()
        if sim_idx_table_name in self.connection.table_names() and not force:
            LOGGER.info("Similarity matrix already exists. Reusing it. Pass force=True to overwrite it.")
            return self.connection.open_table(sim_idx_table_name).to_pandas()

        if top_k and not (1.0 >= top_k >= 0.0):
            raise ValueError(f"top_k must be between 0.0 and 1.0. Got {top_k}")
        if max_dist < 0.0:
            raise ValueError(f"max_dist must be greater than 0. Got {max_dist}")

        top_k = int(top_k * len(self.table)) if top_k else len(self.table)  # è®¡ç®—top_k
        top_k = max(top_k, 1)
        features = self.table.to_lance().to_table(columns=["vector", "im_file"]).to_pydict()  # è·å–ç‰¹å¾
        im_files = features["im_file"]
        embeddings = features["vector"]

        sim_table = self.connection.create_table(sim_idx_table_name, schema=get_sim_index_schema(), mode="overwrite")  # åˆ›å»ºç›¸ä¼¼æ€§ç´¢å¼•è¡¨

        def _yield_sim_idx():
            """ç”ŸæˆåŒ…å«ç›¸ä¼¼æ€§ç´¢å¼•å’Œè·ç¦»çš„æ•°æ®æ¡†ã€‚"""
            for i in tqdm(range(len(embeddings))):
                sim_idx = self.table.search(embeddings[i]).limit(top_k).to_pandas().query(f"_distance <= {max_dist}")  # æŸ¥è¯¢ç›¸ä¼¼å›¾åƒ
                yield [
                    {
                        "idx": i,
                        "im_file": im_files[i],
                        "count": len(sim_idx),
                        "sim_im_files": sim_idx["im_file"].tolist(),
                    }
                ]

        sim_table.add(_yield_sim_idx())  # æ·»åŠ ç›¸ä¼¼æ€§ç´¢å¼•æ•°æ®
        self.sim_index = sim_table
        return sim_table.to_pandas()  # è¿”å›ç›¸ä¼¼æ€§ç´¢å¼•çš„DataFrame

    def plot_similarity_index(self, max_dist: float = 0.2, top_k: float = None, force: bool = False) -> Image:
        """
        ç»˜åˆ¶æ‰€æœ‰å›¾åƒçš„ç›¸ä¼¼æ€§ç´¢å¼•ã€‚
        """
        sim_idx = self.similarity_index(max_dist=max_dist, top_k=top_k, force=force)
        sim_count = sim_idx["count"].tolist()  # è·å–ç›¸ä¼¼å›¾åƒè®¡æ•°
        sim_count = np.array(sim_count)

        indices = np.arange(len(sim_count))

        # åˆ›å»ºæ¡å½¢å›¾
        plt.bar(indices, sim_count)

        # è‡ªå®šä¹‰å›¾è¡¨ï¼ˆå¯é€‰ï¼‰
        plt.xlabel("data idx")
        plt.ylabel("Count")
        plt.title("Similarity Count")
        buffer = BytesIO()
        plt.savefig(buffer, format="png")  # ä¿å­˜å›¾è¡¨åˆ°ç¼“å†²åŒº
        buffer.seek(0)

        # ä½¿ç”¨Pillowä»ç¼“å†²åŒºæ‰“å¼€å›¾åƒ
        return Image.fromarray(np.array(Image.open(buffer)))  # è¿”å›å›¾åƒ

    def _check_imgs_or_idxs(self, img: Union[str, np.ndarray, List[str], List[np.ndarray], None], idx: Union[None, int, List[int]]) -> List[np.ndarray]:
        """æ£€æŸ¥æä¾›çš„å›¾åƒæˆ–ç´¢å¼•ï¼Œç¡®ä¿è‡³å°‘æä¾›ä¸€ä¸ªã€‚"""
        if img is None and idx is None:
            raise ValueError("Either img or idx must be provided.")
        if img is not None and idx is not None:
            raise ValueError("Only one of img or idx must be provided.")
        if idx is not None:
            idx = idx if isinstance(idx, list) else [idx]
            img = self.table.to_lance().take(idx, columns=["im_file"]).to_pydict()["im_file"]  # æ ¹æ®ç´¢å¼•è·å–å›¾åƒ

        return img if isinstance(img, list) else [img]  # è¿”å›å›¾åƒåˆ—è¡¨

    def ask_ai(self, query):
        """
        å‘AIæé—®ã€‚
        """
        result = prompt_sql_query(query)  # ç”ŸæˆSQLæŸ¥è¯¢
        try:
            df = self.sql_query(result)  # æ‰§è¡ŒSQLæŸ¥è¯¢
        except Exception as e:
            LOGGER.error("AI generated query is not valid. Please try again with a different prompt")
            LOGGER.error(e)
            return None
        return df  # è¿”å›æŸ¥è¯¢ç»“æœ

    def visualize(self, result):
        """å¯è§†åŒ–æŸ¥è¯¢ç»“æœã€‚TODOã€‚"""
        pass

    def generate_report(self, result):
        """ç”Ÿæˆæ•°æ®é›†æŠ¥å‘Šã€‚TODOã€‚"""
        pass
```

### æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **ExplorerDataset ç±»**ï¼šè´Ÿè´£åŠ è½½å›¾åƒæ•°æ®é›†ï¼Œæ”¯æŒä»ç£ç›˜è¯»å–å›¾åƒå’Œç”Ÿæˆå›¾åƒçš„è½¬æ¢ã€‚
2. **Explorer ç±»**ï¼šæ ¸å¿ƒåŠŸèƒ½ç±»ï¼Œè´Ÿè´£åˆ›å»ºåµŒå…¥è¡¨ã€æŸ¥è¯¢ç›¸ä¼¼å›¾åƒã€æ‰§è¡ŒSQLæŸ¥è¯¢ã€ç»˜åˆ¶ç»“æœç­‰ã€‚
3. **create_embeddings_table æ–¹æ³•**ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«å›¾åƒåµŒå…¥çš„æ•°æ®åº“è¡¨ã€‚
4. **query æ–¹æ³•**ï¼šæŸ¥è¯¢ç›¸ä¼¼å›¾åƒã€‚
5. **sql_query æ–¹æ³•**ï¼šæ‰§è¡ŒSQLæŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚
6. **similarity_index æ–¹æ³•**ï¼šè®¡ç®—ç›¸ä¼¼æ€§ç´¢å¼•ï¼Œè¿”å›æ¯ä¸ªå›¾åƒçš„ç›¸ä¼¼å›¾åƒåŠå…¶è·ç¦»ã€‚

ä»¥ä¸Šä»£ç å®ç°äº†ä¸€ä¸ªå›¾åƒå¤„ç†å’ŒæŸ¥è¯¢çš„æ¡†æ¶ï¼Œç»“åˆäº†YOLOæ¨¡å‹è¿›è¡Œå›¾åƒåµŒå…¥å’Œç›¸ä¼¼æ€§æœç´¢ã€‚

è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªåä¸º `explorer.py` çš„ Python è„šæœ¬ï¼Œå±äº Ultralytics YOLO é¡¹ç›®ï¼Œä¸»è¦ç”¨äºå›¾åƒæ•°æ®é›†çš„æ¢ç´¢å’Œå¤„ç†ã€‚å®ƒåŒ…å«äº†ä¸€ä¸ª `Explorer` ç±»å’Œä¸€ä¸ª `ExplorerDataset` ç±»ï¼Œå‰è€…ç”¨äºå¤„ç†æ•°æ®é›†çš„æŸ¥è¯¢å’Œç›¸ä¼¼æ€§æœç´¢ï¼Œåè€…åˆ™æ˜¯å¯¹ YOLO æ•°æ®é›†çš„æ‰©å±•ï¼Œæä¾›å›¾åƒåŠ è½½å’Œè½¬æ¢åŠŸèƒ½ã€‚

`ExplorerDataset` ç±»ç»§æ‰¿è‡ª `YOLODataset`ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯åŠ è½½å›¾åƒå¹¶æä¾›è½¬æ¢åŠŸèƒ½ã€‚`load_image` æ–¹æ³•ç”¨äºä»æ•°æ®é›†ä¸­åŠ è½½æŒ‡å®šç´¢å¼•çš„å›¾åƒï¼Œæ”¯æŒä»ç¼“å­˜æˆ–æ–‡ä»¶ä¸­è¯»å–å›¾åƒæ•°æ®ã€‚`build_transforms` æ–¹æ³•åˆ™åˆ›å»ºå›¾åƒè½¬æ¢ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸æ”¹å˜å›¾åƒå¤§å°çš„æƒ…å†µä¸‹è¿›è¡Œæ•°æ®å¢å¼ºã€‚

`Explorer` ç±»æ˜¯æ•´ä¸ªæ¨¡å—çš„æ ¸å¿ƒï¼Œè´Ÿè´£ä¸ LanceDB æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚åˆå§‹åŒ–æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ‰€éœ€çš„åº“æ˜¯å¦å·²å®‰è£…ï¼Œå¹¶è¿æ¥åˆ°æŒ‡å®šçš„æ•°æ®åº“ã€‚ç±»ä¸­æœ‰å¤šä¸ªæ–¹æ³•ç”¨äºåˆ›å»ºå›¾åƒåµŒå…¥è¡¨ã€æŸ¥è¯¢ç›¸ä¼¼å›¾åƒã€æ‰§è¡Œ SQL æŸ¥è¯¢ã€ç»˜åˆ¶æŸ¥è¯¢ç»“æœç­‰ã€‚`create_embeddings_table` æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªåŒ…å«å›¾åƒåµŒå…¥çš„æ•°æ®åº“è¡¨ï¼Œå¦‚æœè¡¨å·²å­˜åœ¨ï¼Œå¯ä»¥é€‰æ‹©è¦†ç›–ã€‚`query` æ–¹æ³•å…è®¸ç”¨æˆ·æŸ¥è¯¢ç›¸ä¼¼å›¾åƒï¼Œæ”¯æŒå•ä¸ªæˆ–å¤šä¸ªå›¾åƒçš„è¾“å…¥ï¼Œå¹¶è¿”å›ç›¸åº”çš„ç»“æœã€‚

æ­¤å¤–ï¼Œ`sql_query` æ–¹æ³•å…è®¸ç”¨æˆ·é€šè¿‡ SQL è¯­å¥æŸ¥è¯¢æ•°æ®åº“ï¼Œæ”¯æŒè¿”å› Pandas DataFrame æˆ– Arrow è¡¨æ ¼æ ¼å¼ã€‚`plot_sql_query` æ–¹æ³•åˆ™ç”¨äºå¯è§†åŒ– SQL æŸ¥è¯¢çš„ç»“æœï¼Œè¿”å›ä¸€å¼ åŒ…å«æŸ¥è¯¢ç»“æœçš„å›¾åƒã€‚`similarity_index` æ–¹æ³•è®¡ç®—æ‰€æœ‰å›¾åƒçš„ç›¸ä¼¼æ€§ç´¢å¼•ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«ç›¸ä¼¼å›¾åƒä¿¡æ¯çš„ DataFrameã€‚

è¯¥ç±»è¿˜æä¾›äº†ä¸€äº›å®ç”¨çš„å¯è§†åŒ–åŠŸèƒ½ï¼Œä¾‹å¦‚ `plot_similarity_index` æ–¹æ³•ç”¨äºç»˜åˆ¶ç›¸ä¼¼æ€§ç´¢å¼•çš„æŸ±çŠ¶å›¾ï¼Œå±•ç¤ºæ¯ä¸ªå›¾åƒçš„ç›¸ä¼¼å›¾åƒæ•°é‡ã€‚`ask_ai` æ–¹æ³•å…è®¸ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€æŸ¥è¯¢å›¾åƒæ•°æ®ï¼Œç³»ç»Ÿä¼šå°†é—®é¢˜è½¬æ¢ä¸º SQL æŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å›¾åƒæ•°æ®é›†æ¢ç´¢å·¥å…·ï¼Œç»“åˆäº†æ·±åº¦å­¦ä¹ æ¨¡å‹çš„åµŒå…¥åŠŸèƒ½å’Œæ•°æ®åº“çš„é«˜æ•ˆæŸ¥è¯¢èƒ½åŠ›ï¼Œé€‚ç”¨äºéœ€è¦å¤„ç†å’Œåˆ†æå¤§é‡å›¾åƒæ•°æ®çš„åœºæ™¯ã€‚

#### 11.2 ui.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ streamlit è¿è¡ŒæŒ‡å®šçš„è„šæœ¬
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤
    result = subprocess.run(command, shell=True)
    # æ£€æŸ¥å‘½ä»¤æ‰§è¡Œçš„è¿”å›ç ï¼Œå¦‚æœä¸ä¸º0ï¼Œè¡¨ç¤ºæ‰§è¡Œå‡ºé”™
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")

# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # è¿™é‡Œå¯ä»¥ç›´æ¥æŒ‡å®šè„šæœ¬å

    # è°ƒç”¨å‡½æ•°è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼š
   - `sys`ï¼šç”¨äºè®¿é—®ä¸ Python è§£é‡Šå™¨ç›¸å…³çš„å˜é‡å’Œå‡½æ•°ã€‚
   - `subprocess`ï¼šç”¨äºåˆ›å»ºæ–°è¿›ç¨‹ã€è¿æ¥åˆ°å®ƒä»¬çš„è¾“å…¥/è¾“å‡º/é”™è¯¯ç®¡é“ï¼Œå¹¶è·å¾—è¿”å›ç ã€‚

2. **å®šä¹‰ `run_script` å‡½æ•°**ï¼š
   - è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•° `script_path`ï¼Œè¡¨ç¤ºè¦è¿è¡Œçš„ Python è„šæœ¬çš„è·¯å¾„ã€‚
   - ä½¿ç”¨ `sys.executable` è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ Python ç¯å¢ƒã€‚

3. **æ„å»ºå‘½ä»¤**ï¼š
   - ä½¿ç”¨ f-string æ„å»ºå‘½ä»¤å­—ç¬¦ä¸²ï¼Œè°ƒç”¨ `streamlit` æ¨¡å—è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

4. **æ‰§è¡Œå‘½ä»¤**ï¼š
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œæ„å»ºçš„å‘½ä»¤ï¼Œå¹¶é€šè¿‡ `shell=True` å…è®¸åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤ã€‚
   - æ£€æŸ¥å‘½ä»¤çš„è¿”å›ç ï¼Œå¦‚æœè¿”å›ç ä¸ä¸º0ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

5. **ä¸»ç¨‹åºå…¥å£**ï¼š
   - ä½¿ç”¨ `if __name__ == "__main__":` ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥è„šæœ¬æ—¶æ‰ä¼šæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚
   - æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¯¥è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶åä¸º `ui.py`ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯ä½¿ç”¨å½“å‰çš„ Python ç¯å¢ƒæ¥è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„è„šæœ¬ï¼Œå…·ä½“æ˜¯ä¸€ä¸ªåä¸º `web.py` çš„æ–‡ä»¶ã€‚ç¨‹åºé¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œè¿™äº›æ¨¡å—æä¾›äº†ä¸ç³»ç»Ÿäº¤äº’å’Œæ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œè¿˜å¯¼å…¥äº† `abs_path` å‡½æ•°ï¼Œç”¨äºè·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚

åœ¨ `run_script` å‡½æ•°ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ­£ç¡®çš„ç¯å¢ƒä¸­è¿è¡Œè„šæœ¬ã€‚æ¥ç€ï¼Œæ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—æ¥è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚`streamlit` æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ•°æ®åº”ç”¨çš„åº“ï¼Œå‘½ä»¤ä¸­åŒ…å«äº†è„šæœ¬çš„è·¯å¾„ã€‚

ç„¶åï¼Œä½¿ç”¨ `subprocess.run` æ–¹æ³•æ¥æ‰§è¡Œæ„å»ºå¥½çš„å‘½ä»¤ã€‚è¯¥æ–¹æ³•ä¼šåœ¨ä¸€ä¸ªæ–°çš„ shell ä¸­è¿è¡Œå‘½ä»¤ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚å¦‚æœè„šæœ¬è¿è¡Œè¿”å›çš„çŠ¶æ€ç ä¸ä¸ºé›¶ï¼Œè¡¨ç¤ºå‡ºç°äº†é”™è¯¯ï¼Œç¨‹åºä¼šæ‰“å°å‡ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œä½¿ç”¨ `if __name__ == "__main__":` è¯­å¥æ¥ç¡®ä¿å½“è„šæœ¬ç›´æ¥è¿è¡Œæ—¶ï¼Œä»¥ä¸‹ä»£ç æ‰ä¼šè¢«æ‰§è¡Œã€‚æ­¤å¤„æŒ‡å®šäº†è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ä¸º `web.py`ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªç¨‹åºçš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿åœ°è¿è¡Œä¸€ä¸ª Streamlit åº”ç”¨ï¼Œé€šè¿‡å°è£…åœ¨ `run_script` å‡½æ•°ä¸­çš„é€»è¾‘ï¼Œä½¿å¾—è„šæœ¬çš„æ‰§è¡Œè¿‡ç¨‹å˜å¾—ç®€å•æ˜äº†ã€‚

#### 11.3 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\utils\ops.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F
from scipy.optimize import linear_sum_assignment
from ultralytics.utils.metrics import bbox_iou

class HungarianMatcher(nn.Module):
    """
    å®ç°åŒˆç‰™åˆ©åŒ¹é…å™¨çš„æ¨¡å—ï¼Œç”¨äºè§£å†³é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†ä¹‹é—´çš„åˆ†é…é—®é¢˜ã€‚
    åŒˆç‰™åˆ©åŒ¹é…å™¨é€šè¿‡ä¸€ä¸ªæˆæœ¬å‡½æ•°æ¥æ‰§è¡Œæœ€ä¼˜åˆ†é…ï¼Œè€ƒè™‘åˆ†ç±»åˆ†æ•°ã€è¾¹ç•Œæ¡†åæ ‡ç­‰ä¿¡æ¯ã€‚
    """

    def __init__(self, cost_gain=None, use_fl=True, with_mask=False, num_sample_points=12544, alpha=0.25, gamma=2.0):
        """åˆå§‹åŒ–åŒˆç‰™åˆ©åŒ¹é…å™¨çš„å‚æ•°ï¼ŒåŒ…æ‹¬æˆæœ¬ç³»æ•°ã€Focal Lossã€æ©ç é¢„æµ‹ç­‰è®¾ç½®ã€‚"""
        super().__init__()
        if cost_gain is None:
            cost_gain = {'class': 1, 'bbox': 5, 'giou': 2, 'mask': 1, 'dice': 1}
        self.cost_gain = cost_gain  # æˆæœ¬ç³»æ•°
        self.use_fl = use_fl  # æ˜¯å¦ä½¿ç”¨Focal Loss
        self.with_mask = with_mask  # æ˜¯å¦ä½¿ç”¨æ©ç é¢„æµ‹
        self.num_sample_points = num_sample_points  # æ©ç æˆæœ¬è®¡ç®—çš„é‡‡æ ·ç‚¹æ•°é‡
        self.alpha = alpha  # Focal Lossä¸­çš„alphaå› å­
        self.gamma = gamma  # Focal Lossä¸­çš„gammaå› å­

    def forward(self, pred_bboxes, pred_scores, gt_bboxes, gt_cls, gt_groups, masks=None, gt_mask=None):
        """
        å‰å‘ä¼ æ’­ï¼Œè®¡ç®—é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†ä¹‹é—´çš„åŒ¹é…ã€‚
        è®¡ç®—åˆ†ç±»æˆæœ¬ã€L1æˆæœ¬å’ŒGIoUæˆæœ¬ï¼Œå¹¶æ ¹æ®è¿™äº›æˆæœ¬æ‰¾åˆ°æœ€ä¼˜åŒ¹é…ã€‚
        """
        bs, nq, nc = pred_scores.shape  # è·å–æ‰¹æ¬¡å¤§å°ã€æŸ¥è¯¢æ•°é‡å’Œç±»åˆ«æ•°é‡

        if sum(gt_groups) == 0:  # å¦‚æœæ²¡æœ‰çœŸå®æ¡†ï¼Œè¿”å›ç©ºåŒ¹é…
            return [(torch.tensor([], dtype=torch.long), torch.tensor([], dtype=torch.long)) for _ in range(bs)]

        # å°†é¢„æµ‹åˆ†æ•°å’Œè¾¹ç•Œæ¡†å±•å¹³ä»¥è®¡ç®—æˆæœ¬çŸ©é˜µ
        pred_scores = pred_scores.detach().view(-1, nc)  # [batch_size * num_queries, num_classes]
        pred_scores = F.sigmoid(pred_scores) if self.use_fl else F.softmax(pred_scores, dim=-1)  # åº”ç”¨æ¿€æ´»å‡½æ•°
        pred_bboxes = pred_bboxes.detach().view(-1, 4)  # [batch_size * num_queries, 4]

        # è®¡ç®—åˆ†ç±»æˆæœ¬
        pred_scores = pred_scores[:, gt_cls]  # é€‰æ‹©ä¸çœŸå®ç±»åˆ«å¯¹åº”çš„é¢„æµ‹åˆ†æ•°
        if self.use_fl:  # å¦‚æœä½¿ç”¨Focal Loss
            neg_cost_class = (1 - self.alpha) * (pred_scores ** self.gamma) * (-(1 - pred_scores + 1e-8).log())
            pos_cost_class = self.alpha * ((1 - pred_scores) ** self.gamma) * (-(pred_scores + 1e-8).log())
            cost_class = pos_cost_class - neg_cost_class  # è®¡ç®—åˆ†ç±»æˆæœ¬
        else:
            cost_class = -pred_scores  # è®¡ç®—åˆ†ç±»æˆæœ¬

        # è®¡ç®—è¾¹ç•Œæ¡†ä¹‹é—´çš„L1æˆæœ¬
        cost_bbox = (pred_bboxes.unsqueeze(1) - gt_bboxes.unsqueeze(0)).abs().sum(-1)  # (bs*num_queries, num_gt)

        # è®¡ç®—è¾¹ç•Œæ¡†ä¹‹é—´çš„GIoUæˆæœ¬
        cost_giou = 1.0 - bbox_iou(pred_bboxes.unsqueeze(1), gt_bboxes.unsqueeze(0), xywh=True, GIoU=True).squeeze(-1)

        # æœ€ç»ˆæˆæœ¬çŸ©é˜µ
        C = self.cost_gain['class'] * cost_class + \
            self.cost_gain['bbox'] * cost_bbox + \
            self.cost_gain['giou'] * cost_giou

        # å¤„ç†æ©ç æˆæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
        if self.with_mask:
            C += self._cost_mask(bs, gt_groups, masks, gt_mask)

        # å°†æ— æ•ˆå€¼ï¼ˆNaNå’Œæ— ç©·å¤§ï¼‰è®¾ç½®ä¸º0
        C[C.isnan() | C.isinf()] = 0.0

        C = C.view(bs, nq, -1).cpu()  # å°†æˆæœ¬çŸ©é˜µé‡å¡‘ä¸º [batch_size, num_queries, num_gt]
        indices = [linear_sum_assignment(c[i]) for i, c in enumerate(C.split(gt_groups, -1))]  # ä½¿ç”¨åŒˆç‰™åˆ©ç®—æ³•è®¡ç®—åŒ¹é…
        gt_groups = torch.as_tensor([0, *gt_groups[:-1]]).cumsum_(0)  # è®¡ç®—çœŸå®æ¡†çš„ç´¯ç§¯å’Œ
        # è¿”å›æ¯ä¸ªæ‰¹æ¬¡çš„åŒ¹é…ç´¢å¼•
        return [(torch.tensor(i, dtype=torch.long), torch.tensor(j, dtype=torch.long) + gt_groups[k])
                for k, (i, j) in enumerate(indices)]
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **åŒˆç‰™åˆ©åŒ¹é…å™¨çš„åˆå§‹åŒ–**ï¼šè®¾ç½®äº†æˆæœ¬ç³»æ•°ã€æ˜¯å¦ä½¿ç”¨Focal Lossã€æ˜¯å¦ä½¿ç”¨æ©ç é¢„æµ‹ç­‰å‚æ•°ã€‚
2. **å‰å‘ä¼ æ’­æ–¹æ³•**ï¼šè®¡ç®—é¢„æµ‹æ¡†ä¸çœŸå®æ¡†ä¹‹é—´çš„åŒ¹é…ï¼Œæ¶‰åŠåˆ†ç±»æˆæœ¬ã€L1æˆæœ¬å’ŒGIoUæˆæœ¬çš„è®¡ç®—ã€‚
3. **æˆæœ¬çŸ©é˜µçš„æ„å»º**ï¼šå°†ä¸åŒç±»å‹çš„æˆæœ¬ç»“åˆèµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆçš„æˆæœ¬çŸ©é˜µã€‚
4. **åŒˆç‰™åˆ©ç®—æ³•**ï¼šä½¿ç”¨`linear_sum_assignment`å‡½æ•°æ‰¾åˆ°æœ€ä¼˜åŒ¹é…ã€‚

é€šè¿‡è¿™äº›æ­¥éª¤ï¼ŒåŒˆç‰™åˆ©åŒ¹é…å™¨èƒ½å¤Ÿæœ‰æ•ˆåœ°è§£å†³ç›®æ ‡æ£€æµ‹ä¸­çš„åˆ†é…é—®é¢˜ã€‚

è¯¥ç¨‹åºæ–‡ä»¶å®ç°äº†ä¸€ä¸ªåä¸º `HungarianMatcher` çš„ç±»ï¼Œä¸»è¦ç”¨äºè§£å†³ç›®æ ‡æ£€æµ‹ä¸­çš„åˆ†é…é—®é¢˜ã€‚å®ƒé€šè¿‡åŒˆç‰™åˆ©ç®—æ³•åœ¨é¢„æµ‹çš„è¾¹ç•Œæ¡†å’ŒçœŸå®çš„è¾¹ç•Œæ¡†ä¹‹é—´è¿›è¡Œæœ€ä¼˜åŒ¹é…ã€‚è¯¥ç±»çš„æ„é€ å‡½æ•°æ¥å—å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬æˆæœ¬ç³»æ•°ã€æ˜¯å¦ä½¿ç”¨ç„¦ç‚¹æŸå¤±ã€æ˜¯å¦è¿›è¡Œæ©ç é¢„æµ‹ã€æ ·æœ¬ç‚¹æ•°é‡ä»¥åŠç„¦ç‚¹æŸå¤±çš„è¶…å‚æ•°ï¼ˆalpha å’Œ gammaï¼‰ã€‚è¿™äº›å‚æ•°ç”¨äºè°ƒæ•´åŒ¹é…è¿‡ç¨‹ä¸­ä¸åŒæˆæœ¬çš„æƒé‡ã€‚

åœ¨ `forward` æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè·å–æ‰¹æ¬¡å¤§å°ã€æŸ¥è¯¢æ•°é‡å’Œç±»åˆ«æ•°é‡ã€‚å¦‚æœå½“å‰æ‰¹æ¬¡æ²¡æœ‰çœŸå®ç›®æ ‡ï¼Œè¿”å›ç©ºçš„åŒ¹é…ç»“æœã€‚æ¥ç€ï¼Œå°†é¢„æµ‹çš„å¾—åˆ†å’Œè¾¹ç•Œæ¡†è¿›è¡Œæ‰å¹³åŒ–å¤„ç†ï¼Œä»¥ä¾¿è®¡ç®—æˆæœ¬çŸ©é˜µã€‚åˆ†ç±»æˆæœ¬é€šè¿‡é¢„æµ‹å¾—åˆ†å’ŒçœŸå®ç±»åˆ«è®¡ç®—å¾—å‡ºï¼Œä½¿ç”¨ç„¦ç‚¹æŸå¤±æ—¶ï¼Œè¿˜ä¼šæ ¹æ® alpha å’Œ gamma è¿›è¡Œè°ƒæ•´ã€‚è¾¹ç•Œæ¡†ä¹‹é—´çš„ L1 æˆæœ¬å’Œå¹¿ä¹‰ IoU æˆæœ¬ä¹Ÿä¼šè¢«è®¡ç®—ã€‚æœ€ç»ˆï¼Œæ‰€æœ‰æˆæœ¬ä¼šæ ¹æ®é¢„è®¾çš„æƒé‡ç»„åˆæˆä¸€ä¸ªæ€»æˆæœ¬çŸ©é˜µã€‚

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ `linear_sum_assignment` å‡½æ•°æ‰¾åˆ°æœ€ä¼˜åŒ¹é…çš„ç´¢å¼•ï¼Œå¹¶è¿”å›æ¯ä¸ªæ‰¹æ¬¡çš„åŒ¹é…ç»“æœï¼ŒåŒ…æ‹¬é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†çš„ç´¢å¼•ã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ª `get_cdn_group` å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå¯¹æ¯”å»å™ªè®­ç»ƒç»„ã€‚è¯¥å‡½æ•°ä»çœŸå®ç›®æ ‡ä¸­ç”Ÿæˆæ­£è´Ÿæ ·æœ¬ï¼Œå¹¶å¯¹ç±»åˆ«æ ‡ç­¾å’Œè¾¹ç•Œæ¡†åæ ‡æ–½åŠ å™ªå£°ã€‚å‡½æ•°æ¥å—å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬æ‰¹æ¬¡æ•°æ®ã€ç±»åˆ«æ•°é‡ã€æŸ¥è¯¢æ•°é‡ã€ç±»åˆ«åµŒå…¥ç­‰ã€‚æ ¹æ®è¾“å…¥çš„æ¡ä»¶ï¼Œå‡½æ•°è¿”å›ä¿®æ”¹åçš„ç±»åˆ«åµŒå…¥ã€è¾¹ç•Œæ¡†ã€æ³¨æ„åŠ›æ©ç å’Œå…ƒä¿¡æ¯ã€‚

æ€»çš„æ¥è¯´ï¼Œè¯¥æ–‡ä»¶çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å®ç°ç›®æ ‡æ£€æµ‹ä¸­çš„åŒ¹é…æœºåˆ¶ï¼Œé€šè¿‡ä¼˜åŒ–æˆæœ¬å‡½æ•°æ¥æé«˜æ¨¡å‹çš„æ£€æµ‹ç²¾åº¦ï¼ŒåŒæ—¶æä¾›å¯¹æ¯”å»å™ªçš„è®­ç»ƒæ–¹æ³•ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚

#### 11.4 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\modules\utils.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn.functional as F

def multi_scale_deformable_attn_pytorch(value: torch.Tensor, value_spatial_shapes: torch.Tensor,
                                        sampling_locations: torch.Tensor,
                                        attention_weights: torch.Tensor) -> torch.Tensor:
    """
    å¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶ã€‚

    å‚æ•°:
        value: è¾“å…¥ç‰¹å¾å›¾ï¼Œå½¢çŠ¶ä¸º (bs, C, num_heads, embed_dims)ï¼Œ
               å…¶ä¸­ bs æ˜¯æ‰¹é‡å¤§å°ï¼ŒC æ˜¯é€šé“æ•°ï¼Œnum_heads æ˜¯å¤´æ•°ï¼Œembed_dims æ˜¯æ¯ä¸ªå¤´çš„ç»´åº¦ã€‚
        value_spatial_shapes: ç‰¹å¾å›¾çš„ç©ºé—´å½¢çŠ¶ï¼Œå½¢çŠ¶ä¸º (num_levels, 2)ï¼Œ
                              æ¯ä¸€è¡ŒåŒ…å«ç‰¹å¾å›¾çš„é«˜åº¦å’Œå®½åº¦ã€‚
        sampling_locations: é‡‡æ ·ä½ç½®ï¼Œå½¢çŠ¶ä¸º (bs, num_queries, num_heads, num_levels, num_points, 2)ï¼Œ
                           å…¶ä¸­ num_queries æ˜¯æŸ¥è¯¢çš„æ•°é‡ï¼Œnum_levels æ˜¯ç‰¹å¾å›¾çš„å±‚æ•°ï¼Œnum_points æ˜¯æ¯å±‚çš„é‡‡æ ·ç‚¹æ•°ã€‚
        attention_weights: æ³¨æ„åŠ›æƒé‡ï¼Œå½¢çŠ¶ä¸º (bs, num_heads, num_queries, num_levels, num_points)ã€‚

    è¿”å›:
        output: è¾“å‡ºç‰¹å¾å›¾ï¼Œå½¢çŠ¶ä¸º (bs, num_queries, num_heads * embed_dims)ã€‚
    """

    # è·å–è¾“å…¥å¼ é‡çš„å½¢çŠ¶
    bs, _, num_heads, embed_dims = value.shape
    _, num_queries, _, num_levels, num_points, _ = sampling_locations.shape

    # å°†è¾“å…¥ç‰¹å¾å›¾æ ¹æ®ç©ºé—´å½¢çŠ¶æ‹†åˆ†æˆå¤šä¸ªç‰¹å¾å›¾
    value_list = value.split([H_ * W_ for H_, W_ in value_spatial_shapes], dim=1)

    # å°†é‡‡æ ·ä½ç½®è½¬æ¢åˆ°[-1, 1]çš„èŒƒå›´
    sampling_grids = 2 * sampling_locations - 1
    sampling_value_list = []

    # éå†æ¯ä¸ªç‰¹å¾å›¾å±‚
    for level, (H_, W_) in enumerate(value_spatial_shapes):
        # å¯¹ç‰¹å¾å›¾è¿›è¡Œé‡å¡‘å’Œè½¬ç½®ä»¥é€‚åº”åç»­çš„é‡‡æ ·
        value_l_ = (value_list[level].flatten(2).transpose(1, 2).reshape(bs * num_heads, embed_dims, H_, W_))

        # è·å–å½“å‰å±‚çš„é‡‡æ ·ç½‘æ ¼
        sampling_grid_l_ = sampling_grids[:, :, :, level].transpose(1, 2).flatten(0, 1)

        # ä½¿ç”¨åŒçº¿æ€§æ’å€¼ä»ç‰¹å¾å›¾ä¸­é‡‡æ ·
        sampling_value_l_ = F.grid_sample(value_l_,
                                          sampling_grid_l_,
                                          mode='bilinear',
                                          padding_mode='zeros',
                                          align_corners=False)
        sampling_value_list.append(sampling_value_l_)

    # å¤„ç†æ³¨æ„åŠ›æƒé‡
    attention_weights = attention_weights.transpose(1, 2).reshape(bs * num_heads, 1, num_queries,
                                                                  num_levels * num_points)

    # è®¡ç®—æœ€ç»ˆè¾“å‡º
    output = ((torch.stack(sampling_value_list, dim=-2).flatten(-2) * attention_weights).sum(-1).view(
        bs, num_heads * embed_dims, num_queries))

    return output.transpose(1, 2).contiguous()  # è¿”å›è½¬ç½®åçš„è¾“å‡º
```

### ä»£ç è¯´æ˜ï¼š
1. **è¾“å…¥å‚æ•°**ï¼š
   - `value`ï¼šè¾“å…¥ç‰¹å¾å›¾ï¼ŒåŒ…å«å¤šä¸ªå¤´çš„ç‰¹å¾ä¿¡æ¯ã€‚
   - `value_spatial_shapes`ï¼šç‰¹å¾å›¾çš„ç©ºé—´ç»´åº¦ä¿¡æ¯ï¼Œç”¨äºæ‹†åˆ†ç‰¹å¾å›¾ã€‚
   - `sampling_locations`ï¼šæŒ‡å®šä»ç‰¹å¾å›¾ä¸­é‡‡æ ·çš„ä½ç½®ã€‚
   - `attention_weights`ï¼šæ¯ä¸ªé‡‡æ ·ç‚¹çš„æ³¨æ„åŠ›æƒé‡ã€‚

2. **åŠŸèƒ½**ï¼š
   - è¯¥å‡½æ•°å®ç°äº†å¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶ï¼Œé€šè¿‡ä»ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ä¸­é‡‡æ ·ï¼Œå¹¶æ ¹æ®æ³¨æ„åŠ›æƒé‡åŠ æƒç»„åˆè¿™äº›é‡‡æ ·ç»“æœï¼Œæœ€ç»ˆç”Ÿæˆè¾“å‡ºç‰¹å¾å›¾ã€‚

3. **æ ¸å¿ƒæ­¥éª¤**ï¼š
   - å°†è¾“å…¥ç‰¹å¾å›¾æ ¹æ®ç©ºé—´å½¢çŠ¶æ‹†åˆ†ã€‚
   - å°†é‡‡æ ·ä½ç½®è½¬æ¢åˆ°[-1, 1]çš„èŒƒå›´ã€‚
   - ä½¿ç”¨åŒçº¿æ€§æ’å€¼ä»ç‰¹å¾å›¾ä¸­é‡‡æ ·ã€‚
   - è®¡ç®—åŠ æƒå’Œä»¥ç”Ÿæˆæœ€ç»ˆè¾“å‡ºç‰¹å¾å›¾ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOçš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦åŒ…å«äº†ä¸€äº›å®ç”¨çš„å·¥å…·å‡½æ•°ï¼Œç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ„å»ºå’Œè®­ç»ƒã€‚ä»£ç ä¸­ä½¿ç”¨äº†PyTorchåº“ï¼Œæ¶‰åŠåˆ°æ¨¡å—çš„å…‹éš†ã€æƒé‡åˆå§‹åŒ–ã€åsigmoidå‡½æ•°çš„è®¡ç®—ä»¥åŠå¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶çš„å®ç°ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ª `_get_clones` å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºä»ç»™å®šçš„æ¨¡å—åˆ›å»ºå¤šä¸ªå…‹éš†æ¨¡å—ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«è¿™äº›å…‹éš†æ¨¡å—çš„ `ModuleList`ã€‚è¿™ç§æ–¹æ³•åœ¨æ„å»ºç¥ç»ç½‘ç»œæ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦é‡å¤ä½¿ç”¨ç›¸åŒç»“æ„çš„æƒ…å†µä¸‹ã€‚

æ¥ä¸‹æ¥ï¼Œ`bias_init_with_prob` å‡½æ•°ç”¨äºæ ¹æ®ç»™å®šçš„å…ˆéªŒæ¦‚ç‡åˆå§‹åŒ–å·ç§¯æˆ–å…¨è¿æ¥å±‚çš„åç½®å€¼ã€‚è¿™ä¸ªå‡½æ•°é€šè¿‡è®¡ç®—åç½®çš„åˆå§‹å€¼ï¼Œä½¿å¾—åœ¨è®­ç»ƒå¼€å§‹æ—¶æ¨¡å‹çš„è¾“å‡ºæ›´ç¬¦åˆé¢„æœŸçš„æ¦‚ç‡åˆ†å¸ƒã€‚

`linear_init_` å‡½æ•°åˆ™æ˜¯ç”¨äºåˆå§‹åŒ–çº¿æ€§æ¨¡å—çš„æƒé‡å’Œåç½®ã€‚å®ƒä½¿ç”¨å‡åŒ€åˆ†å¸ƒåœ¨ä¸€ä¸ªç‰¹å®šçš„èŒƒå›´å†…å¯¹æƒé‡è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”å¦‚æœæ¨¡å—æœ‰åç½®ï¼Œåˆ™åŒæ ·å¯¹åç½®è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™ç§åˆå§‹åŒ–æ–¹æ³•æœ‰åŠ©äºåŠ é€Ÿæ¨¡å‹çš„æ”¶æ•›ã€‚

`inverse_sigmoid` å‡½æ•°è®¡ç®—ç»™å®šå¼ é‡çš„åsigmoidå‡½æ•°ã€‚å®ƒé¦–å…ˆå°†è¾“å…¥é™åˆ¶åœ¨0åˆ°1ä¹‹é—´ï¼Œç„¶åé€šè¿‡è®¡ç®—logitå€¼æ¥è¿”å›ç»“æœã€‚è¿™ä¸ªå‡½æ•°åœ¨æŸäº›æ¨¡å‹ä¸­ç”¨äºå¤„ç†æ¦‚ç‡å€¼çš„è½¬æ¢ã€‚

æœ€åï¼Œ`multi_scale_deformable_attn_pytorch` å‡½æ•°å®ç°äº†å¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶ã€‚è¯¥å‡½æ•°æ¥å—å¤šä¸ªè¾“å…¥ï¼ŒåŒ…æ‹¬å€¼å¼ é‡ã€ç©ºé—´å½¢çŠ¶ã€é‡‡æ ·ä½ç½®å’Œæ³¨æ„åŠ›æƒé‡ã€‚å®ƒé€šè¿‡å¯¹è¾“å…¥è¿›è¡Œä¸€ç³»åˆ—çš„å¼ é‡æ“ä½œï¼Œè®¡ç®—å‡ºå¤šå°ºåº¦çš„æ³¨æ„åŠ›è¾“å‡ºã€‚è¿™ä¸ªå‡½æ•°çš„å®ç°ç»†èŠ‚åŒ…æ‹¬å¯¹è¾“å…¥å¼ é‡çš„é‡å¡‘ã€è½¬ç½®å’Œä½¿ç”¨åŒçº¿æ€§æ’å€¼è¿›è¡Œé‡‡æ ·ç­‰æ“ä½œï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªç»è¿‡æ³¨æ„åŠ›åŠ æƒçš„è¾“å‡ºå¼ é‡ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€äº›åŸºç¡€çš„å·¥å…·å‡½æ•°ï¼Œæ—¨åœ¨æ”¯æŒYOLOv8æ¨¡å‹çš„æ„å»ºå’Œè®­ç»ƒï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚çš„æ³¨æ„åŠ›æœºåˆ¶æ—¶ã€‚è¿™äº›å‡½æ•°çš„è®¾è®¡è€ƒè™‘äº†æ¨¡å—çš„å¯é‡ç”¨æ€§å’Œåˆå§‹åŒ–çš„æœ‰æ•ˆæ€§ï¼Œä¸ºåç»­çš„æ¨¡å‹è®­ç»ƒæä¾›äº†è‰¯å¥½çš„åŸºç¡€ã€‚

#### 11.5 code\ultralytics\utils\callbacks\neptune.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
# å¯¼å…¥å¿…è¦çš„åº“
from ultralytics.utils import LOGGER, SETTINGS, TESTS_RUNNING

# å°è¯•å¯¼å…¥NeptuneAIåº“å¹¶è¿›è¡Œåˆå§‹åŒ–
try:
    assert not TESTS_RUNNING  # ç¡®ä¿ä¸åœ¨æµ‹è¯•è¿è¡Œä¸­
    assert SETTINGS["neptune"] is True  # ç¡®ä¿Neptuneé›†æˆå·²å¯ç”¨
    import neptune
    from neptune.types import File

    assert hasattr(neptune, "__version__")  # ç¡®ä¿Neptuneåº“ç‰ˆæœ¬å­˜åœ¨

    run = None  # NeptuneAIå®éªŒè®°å½•å®ä¾‹

except (ImportError, AssertionError):
    neptune = None  # å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œåˆ™å°†neptuneè®¾ç½®ä¸ºNone


def _log_scalars(scalars, step=0):
    """å°†æ ‡é‡æ•°æ®è®°å½•åˆ°NeptuneAIå®éªŒè®°å½•å™¨ä¸­ã€‚"""
    if run:  # å¦‚æœNeptuneAIå®ä¾‹å·²åˆå§‹åŒ–
        for k, v in scalars.items():  # éå†æ ‡é‡å­—å…¸
            run[k].append(value=v, step=step)  # è®°å½•æ ‡é‡å€¼å’Œæ­¥éª¤


def _log_images(imgs_dict, group=""):
    """å°†å›¾åƒè®°å½•åˆ°NeptuneAIå®éªŒè®°å½•å™¨ä¸­ã€‚"""
    if run:  # å¦‚æœNeptuneAIå®ä¾‹å·²åˆå§‹åŒ–
        for k, v in imgs_dict.items():  # éå†å›¾åƒå­—å…¸
            run[f"{group}/{k}"].upload(File(v))  # ä¸Šä¼ å›¾åƒæ–‡ä»¶


def on_pretrain_routine_start(trainer):
    """åœ¨è®­ç»ƒä¾‹ç¨‹å¼€å§‹ä¹‹å‰è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    try:
        global run
        # åˆå§‹åŒ–Neptuneè¿è¡Œ
        run = neptune.init_run(project=trainer.args.project or "YOLOv8", name=trainer.args.name, tags=["YOLOv8"])
        # è®°å½•è¶…å‚æ•°é…ç½®
        run["Configuration/Hyperparameters"] = {k: "" if v is None else v for k, v in vars(trainer.args).items()}
    except Exception as e:
        LOGGER.warning(f"WARNING âš ï¸ NeptuneAIå®‰è£…ä½†æœªæ­£ç¡®åˆå§‹åŒ–ï¼Œæœªè®°å½•æ­¤è¿è¡Œã€‚ {e}")


def on_train_epoch_end(trainer):
    """æ¯ä¸ªè®­ç»ƒå‘¨æœŸç»“æŸæ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    # è®°å½•è®­ç»ƒæŸå¤±å’Œå­¦ä¹ ç‡
    _log_scalars(trainer.label_loss_items(trainer.tloss, prefix="train"), trainer.epoch + 1)
    _log_scalars(trainer.lr, trainer.epoch + 1)
    if trainer.epoch == 1:  # å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªå‘¨æœŸ
        # è®°å½•è®­ç»ƒæ‰¹æ¬¡çš„å›¾åƒ
        _log_images({f.stem: str(f) for f in trainer.save_dir.glob("train_batch*.jpg")}, "Mosaic")


def on_train_end(trainer):
    """è®­ç»ƒç»“æŸæ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    if run:  # å¦‚æœNeptuneAIå®ä¾‹å·²åˆå§‹åŒ–
        # è®°å½•æœ€ç»ˆç»“æœå’Œæ··æ·†çŸ©é˜µã€PRå›¾
        files = [
            "results.png",
            "confusion_matrix.png",
            "confusion_matrix_normalized.png",
            *(f"{x}_curve.png" for x in ("F1", "PR", "P", "R")),
        ]
        # è¿‡æ»¤å­˜åœ¨çš„æ–‡ä»¶
        files = [(trainer.save_dir / f) for f in files if (trainer.save_dir / f).exists()]
        for f in files:
            _log_plot(title=f.stem, plot_path=f)  # è®°å½•å›¾è¡¨
        # è®°å½•æœ€ç»ˆæ¨¡å‹
        run[f"weights/{trainer.args.name or trainer.args.task}/{trainer.best.name}"].upload(File(str(trainer.best)))


# å®šä¹‰å›è°ƒå‡½æ•°é›†åˆï¼Œå¦‚æœNeptuneæœªåˆå§‹åŒ–åˆ™ä¸ºç©º
callbacks = (
    {
        "on_pretrain_routine_start": on_pretrain_routine_start,
        "on_train_epoch_end": on_train_epoch_end,
        "on_fit_epoch_end": on_fit_epoch_end,
        "on_val_end": on_val_end,
        "on_train_end": on_train_end,
    }
    if neptune
    else {}
)
```

### ä»£ç è¯´æ˜ï¼š
1. **NeptuneAIåˆå§‹åŒ–**ï¼šä»£ç é¦–å…ˆå°è¯•å¯¼å…¥NeptuneAIåº“å¹¶è¿›è¡Œåˆå§‹åŒ–ï¼Œä»¥ä¾¿è®°å½•å®éªŒæ•°æ®ã€‚å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œåˆ™å°†`neptune`è®¾ç½®ä¸º`None`ï¼Œåç»­çš„è®°å½•æ“ä½œå°†ä¸ä¼šæ‰§è¡Œã€‚

2. **è®°å½•æ ‡é‡å’Œå›¾åƒ**ï¼šå®šä¹‰äº†ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°`_log_scalars`å’Œ`_log_images`ï¼Œç”¨äºå°†è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ ‡é‡æ•°æ®ï¼ˆå¦‚æŸå¤±å’Œå­¦ä¹ ç‡ï¼‰å’Œå›¾åƒï¼ˆå¦‚è®­ç»ƒæ‰¹æ¬¡å›¾åƒï¼‰è®°å½•åˆ°NeptuneAIä¸­ã€‚

3. **å›è°ƒå‡½æ•°**ï¼šå®šä¹‰äº†ä¸€ç³»åˆ—å›è°ƒå‡½æ•°ï¼ˆå¦‚`on_pretrain_routine_start`ã€`on_train_epoch_end`ã€`on_train_end`ç­‰ï¼‰ï¼Œè¿™äº›å‡½æ•°åœ¨è®­ç»ƒçš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ï¼Œä»¥è®°å½•ç›¸åº”çš„è®­ç»ƒä¿¡æ¯ã€‚

4. **å›è°ƒé›†åˆ**ï¼šæœ€åï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å›è°ƒå‡½æ•°çš„å­—å…¸ï¼Œå¦‚æœNeptuneæœªåˆå§‹åŒ–ï¼Œåˆ™è¯¥å­—å…¸ä¸ºç©ºã€‚è¿™ä½¿å¾—åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥çµæ´»åœ°è°ƒç”¨ç›¸åº”çš„è®°å½•å‡½æ•°ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ç”¨äºä¸NeptuneAIè¿›è¡Œé›†æˆçš„å›è°ƒå‡½æ•°ï¼Œä¸»è¦ç”¨äºåœ¨è®­ç»ƒYOLOæ¨¡å‹æ—¶è®°å½•å®éªŒæ•°æ®å’Œç»“æœã€‚æ–‡ä»¶é¦–å…ˆå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„æ¨¡å—å’Œåº“ï¼Œå¹¶å°è¯•åˆå§‹åŒ–NeptuneAIçš„å®éªŒè®°å½•å™¨ã€‚å¦‚æœNeptuneAIæœªæ­£ç¡®å®‰è£…æˆ–æœªå¯ç”¨ï¼Œåˆ™ä¼šæ•è·å¼‚å¸¸å¹¶å°†`neptune`è®¾ç½®ä¸º`None`ã€‚

æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›ç§æœ‰å‡½æ•°ï¼Œä¸»è¦ç”¨äºè®°å½•ä¸åŒç±»å‹çš„æ•°æ®åˆ°NeptuneAIä¸­ã€‚`_log_scalars`å‡½æ•°ç”¨äºè®°å½•æ ‡é‡æ•°æ®ï¼Œä¾‹å¦‚æŸå¤±å€¼å’Œå­¦ä¹ ç‡ï¼›`_log_images`å‡½æ•°ç”¨äºè®°å½•å›¾åƒæ•°æ®ï¼Œé€šå¸¸æ˜¯è®­ç»ƒè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å›¾åƒï¼›`_log_plot`å‡½æ•°ç”¨äºè®°å½•ç»˜å›¾æ•°æ®ï¼Œå¦‚è®­ç»ƒç»“æœçš„å¯è§†åŒ–å›¾ã€‚

æ¥ä¸‹æ¥ï¼Œæ–‡ä»¶å®šä¹‰äº†ä¸€äº›å›è°ƒå‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨ç‰¹å®šçš„è®­ç»ƒé˜¶æ®µè¢«è°ƒç”¨ã€‚`on_pretrain_routine_start`å‡½æ•°åœ¨è®­ç»ƒå¼€å§‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–NeptuneAIçš„å®éªŒè®°å½•å™¨å¹¶è®°å½•è¶…å‚æ•°é…ç½®ã€‚`on_train_epoch_end`å‡½æ•°åœ¨æ¯ä¸ªè®­ç»ƒå‘¨æœŸç»“æŸæ—¶è¢«è°ƒç”¨ï¼Œè®°å½•è®­ç»ƒæŸå¤±å’Œå­¦ä¹ ç‡ï¼Œå¹¶åœ¨ç¬¬ä¸€è½®ç»“æŸæ—¶è®°å½•è®­ç»ƒæ‰¹æ¬¡çš„å›¾åƒã€‚`on_fit_epoch_end`å‡½æ•°åœ¨æ¯ä¸ªè®­ç»ƒå’ŒéªŒè¯å‘¨æœŸç»“æŸæ—¶è¢«è°ƒç”¨ï¼Œè®°å½•æ¨¡å‹çš„é…ç½®ä¿¡æ¯å’ŒæŒ‡æ ‡ã€‚`on_val_end`å‡½æ•°åœ¨æ¯æ¬¡éªŒè¯ç»“æŸæ—¶è¢«è°ƒç”¨ï¼Œè®°å½•éªŒè¯é›†çš„å›¾åƒã€‚`on_train_end`å‡½æ•°åœ¨è®­ç»ƒç»“æŸæ—¶è¢«è°ƒç”¨ï¼Œè®°å½•æœ€ç»ˆçš„ç»“æœï¼ŒåŒ…æ‹¬æ··æ·†çŸ©é˜µå’Œå…¶ä»–æ€§èƒ½æ›²çº¿ï¼Œå¹¶ä¸Šä¼ æœ€ä½³æ¨¡å‹çš„æƒé‡ã€‚

æœ€åï¼Œæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ª`callbacks`å­—å…¸ï¼Œå¦‚æœNeptuneAIå¯ç”¨ï¼Œåˆ™å°†ä¹‹å‰å®šä¹‰çš„å›è°ƒå‡½æ•°æ·»åŠ åˆ°å­—å…¸ä¸­ï¼Œä»¥ä¾¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¢«è°ƒç”¨ã€‚è¿™äº›å›è°ƒå‡½æ•°æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥è®°å½•å’Œç›‘æ§æ¨¡å‹è®­ç»ƒçš„å„ä¸ªé˜¶æ®µã€‚

#### 11.6 train.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import random
import numpy as np
import torch.nn as nn
from ultralytics.data import build_dataloader, build_yolo_dataset
from ultralytics.engine.trainer import BaseTrainer
from ultralytics.models import yolo
from ultralytics.nn.tasks import DetectionModel
from ultralytics.utils import LOGGER, RANK
from ultralytics.utils.torch_utils import de_parallel, torch_distributed_zero_first

class DetectionTrainer(BaseTrainer):
    """
    åŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒç±»ï¼Œç»§æ‰¿è‡ªBaseTrainerç±»ã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»ºYOLOæ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ï¼Œ'train'è¡¨ç¤ºè®­ç»ƒæ¨¡å¼ï¼Œ'val'è¡¨ç¤ºéªŒè¯æ¨¡å¼ã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œé€‚ç”¨äº'rect'æ¨¡å¼ã€‚é»˜è®¤ä¸ºNoneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]
        with torch_distributed_zero_first(rank):  # åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œç¡®ä¿æ•°æ®é›†åªåˆå§‹åŒ–ä¸€æ¬¡
            dataset = self.build_dataset(dataset_path, mode, batch_size)
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        workers = self.args.workers if mode == "train" else self.args.workers * 2
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # å½’ä¸€åŒ–å›¾åƒ
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©æ–°çš„å›¾åƒå¤§å°
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è°ƒæ•´å›¾åƒå¤§å°
            batch["img"] = imgs
        return batch

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å›YOLOæ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )

    def plot_metrics(self):
        """ä»CSVæ–‡ä»¶ä¸­ç»˜åˆ¶æŒ‡æ ‡ã€‚"""
        plot_results(file=self.csv, on_plot=self.on_plot)  # ä¿å­˜ç»“æœå›¾
```

### ä»£ç è¯´æ˜ï¼š
1. **ç±»å®šä¹‰**ï¼š`DetectionTrainer`ç±»ç»§æ‰¿è‡ª`BaseTrainer`ï¼Œç”¨äºå¤„ç†YOLOæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚
2. **æ•°æ®é›†æ„å»º**ï¼š`build_dataset`æ–¹æ³•æ ¹æ®è¾“å…¥è·¯å¾„å’Œæ¨¡å¼æ„å»ºYOLOæ•°æ®é›†ã€‚
3. **æ•°æ®åŠ è½½å™¨**ï¼š`get_dataloader`æ–¹æ³•æ„é€ æ•°æ®åŠ è½½å™¨ï¼Œæ”¯æŒåˆ†å¸ƒå¼è®­ç»ƒã€‚
4. **æ‰¹å¤„ç†é¢„å¤„ç†**ï¼š`preprocess_batch`æ–¹æ³•å¯¹è¾“å…¥å›¾åƒæ‰¹æ¬¡è¿›è¡Œå½’ä¸€åŒ–å’Œå°ºå¯¸è°ƒæ•´ã€‚
5. **æ¨¡å‹è·å–**ï¼š`get_model`æ–¹æ³•è¿”å›YOLOæ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
6. **ç»˜å›¾åŠŸèƒ½**ï¼š`plot_training_samples`å’Œ`plot_metrics`æ–¹æ³•ç”¨äºå¯è§†åŒ–è®­ç»ƒæ ·æœ¬å’Œè®­ç»ƒæŒ‡æ ‡ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è„šæœ¬ï¼Œä¸»è¦åŸºäº YOLOï¼ˆYou Only Look Onceï¼‰æ¨¡å‹ã€‚å®ƒç»§æ‰¿è‡ª `BaseTrainer` ç±»ï¼Œä¸“æ³¨äºæ„å»ºå’Œè®­ç»ƒ YOLO æ¨¡å‹ã€‚æ–‡ä»¶ä¸­åŒ…å«äº†å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•è´Ÿè´£ä¸åŒçš„åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è¯´æ˜ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ·±åº¦å­¦ä¹ æ¡†æ¶ PyTorch ç›¸å…³çš„æ¨¡å—ï¼Œä»¥åŠ Ultralytics æä¾›çš„ç”¨äºæ•°æ®å¤„ç†ã€æ¨¡å‹æ„å»ºå’Œè®­ç»ƒçš„å·¥å…·ã€‚

`DetectionTrainer` ç±»æ˜¯è¿™ä¸ªæ–‡ä»¶çš„æ ¸å¿ƒï¼ŒåŒ…å«äº†å¤šä¸ªæ–¹æ³•æ¥å®ç°è®­ç»ƒè¿‡ç¨‹ä¸­çš„å„ä¸ªæ­¥éª¤ã€‚`build_dataset` æ–¹æ³•ç”¨äºæ„å»º YOLO æ•°æ®é›†ï¼Œæ¥å—å›¾åƒè·¯å¾„ã€æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰å’Œæ‰¹æ¬¡å¤§å°ä½œä¸ºå‚æ•°ã€‚å®ƒä½¿ç”¨ `build_yolo_dataset` å‡½æ•°æ¥åˆ›å»ºæ•°æ®é›†ï¼Œå¹¶æ ¹æ®æ¨¡å¼è®¾ç½®ä¸åŒçš„å¢å¼ºæ–¹å¼ã€‚

`get_dataloader` æ–¹æ³•ç”¨äºæ„å»ºæ•°æ®åŠ è½½å™¨ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒæ—¶åªåˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†ã€‚å®ƒæ ¹æ®æ¨¡å¼å†³å®šæ˜¯å¦æ‰“ä¹±æ•°æ®ï¼Œå¹¶è®¾ç½®å·¥ä½œçº¿ç¨‹çš„æ•°é‡ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå¯ä»¥è¿­ä»£çš„æ•°æ®åŠ è½½å™¨ï¼Œç”¨äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ‰¹é‡åŠ è½½æ•°æ®ã€‚

`preprocess_batch` æ–¹æ³•è´Ÿè´£å¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å°†å›¾åƒç¼©æ”¾åˆ°é€‚å½“çš„å¤§å°å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ã€‚è¯¥æ–¹æ³•è¿˜æ”¯æŒå¤šå°ºåº¦è®­ç»ƒï¼Œé€šè¿‡éšæœºé€‰æ‹©å›¾åƒå¤§å°æ¥å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚

`set_model_attributes` æ–¹æ³•ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ç­‰ã€‚è¿™äº›ä¿¡æ¯æ˜¯è®­ç»ƒè¿‡ç¨‹ä¸­æ‰€éœ€çš„è¶…å‚æ•°ã€‚

`get_model` æ–¹æ³•è¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹å®ä¾‹ï¼Œå¯ä»¥é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚è¿™ä¸ªæ–¹æ³•ç¡®ä¿æ¨¡å‹çš„é…ç½®ä¸æ•°æ®é›†çš„ç±»åˆ«æ•°é‡ä¸€è‡´ã€‚

`get_validator` æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºéªŒè¯æ¨¡å‹æ€§èƒ½çš„éªŒè¯å™¨ã€‚å®ƒä¼šè®°å½•æŸå¤±å€¼ï¼ŒåŒ…æ‹¬è¾¹ç•Œæ¡†æŸå¤±ã€ç±»åˆ«æŸå¤±å’Œåˆ†å¸ƒæŸå¤±ç­‰ã€‚

`label_loss_items` æ–¹æ³•ç”¨äºè¿”å›å¸¦æœ‰æ ‡ç­¾çš„è®­ç»ƒæŸå¤±é¡¹å­—å…¸ï¼Œä¾¿äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è·Ÿè¸ªæŸå¤±å˜åŒ–ã€‚

`progress_string` æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰çš„ epochã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ã€å®ä¾‹æ•°é‡å’Œå›¾åƒå¤§å°ç­‰ä¿¡æ¯ã€‚

`plot_training_samples` æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ ‡æ³¨ï¼Œå¸®åŠ©å¯è§†åŒ–è®­ç»ƒæ•°æ®çš„è´¨é‡ã€‚å®ƒå°†å›¾åƒã€ç±»åˆ«å’Œè¾¹ç•Œæ¡†ç­‰ä¿¡æ¯ä¼ é€’ç»™ `plot_images` å‡½æ•°è¿›è¡Œç»˜åˆ¶ã€‚

æœ€åï¼Œ`plot_metrics` å’Œ `plot_training_labels` æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œæ ‡ç­¾ï¼Œå¸®åŠ©åˆ†ææ¨¡å‹çš„è®­ç»ƒæ•ˆæœå’Œæ•°æ®åˆ†å¸ƒã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ª `train.py` æ–‡ä»¶å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹è®­ç»ƒæµç¨‹ï¼Œæ¶µç›–äº†æ•°æ®é›†æ„å»ºã€æ•°æ®åŠ è½½ã€æ¨¡å‹è®­ç»ƒã€æŸå¤±è®¡ç®—å’Œç»“æœå¯è§†åŒ–ç­‰å¤šä¸ªæ–¹é¢ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªåŸºäº YOLOv8 çš„ç›®æ ‡æ£€æµ‹ç³»ç»Ÿï¼Œæ¶µç›–äº†æ•°æ®å¤„ç†ã€æ¨¡å‹è®­ç»ƒã€è¯„ä¼°å’Œå¯è§†åŒ–ç­‰å¤šä¸ªæ–¹é¢ã€‚ç¨‹åºçš„ç»“æ„æ¨¡å—åŒ–ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. **æ•°æ®å¤„ç†**ï¼šåŒ…æ‹¬æ•°æ®é›†çš„æ„å»ºã€åŠ è½½å’Œé¢„å¤„ç†ï¼Œç¡®ä¿è®­ç»ƒå’ŒéªŒè¯è¿‡ç¨‹ä¸­èƒ½å¤Ÿé«˜æ•ˆåœ°è¯»å–å’Œå¤„ç†å›¾åƒæ•°æ®ã€‚
2. **æ¨¡å‹æ„å»º**ï¼šå®ç° YOLOv8 æ¨¡å‹çš„æ„å»ºå’Œåˆå§‹åŒ–ï¼Œæ”¯æŒåŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
3. **è®­ç»ƒè¿‡ç¨‹**ï¼šæä¾›è®­ç»ƒçš„ä¸»è¦é€»è¾‘ï¼ŒåŒ…æ‹¬æŸå¤±è®¡ç®—ã€æ¨¡å‹æ›´æ–°å’Œè®­ç»ƒè¿›åº¦ç›‘æ§ã€‚
4. **è¯„ä¼°ä¸å¯è§†åŒ–**ï¼šåœ¨è®­ç»ƒå’ŒéªŒè¯è¿‡ç¨‹ä¸­è®°å½•æŒ‡æ ‡ï¼Œæ”¯æŒå¯è§†åŒ–è®­ç»ƒæ ·æœ¬ã€æŸå¤±æ›²çº¿å’Œå…¶ä»–æ€§èƒ½æŒ‡æ ‡ã€‚
5. **å›è°ƒæœºåˆ¶**ï¼šé›†æˆäº†å¤šç§å›è°ƒå‡½æ•°ï¼Œç”¨äºè®°å½•å®éªŒæ•°æ®ã€ç›‘æ§è®­ç»ƒè¿‡ç¨‹å’Œæ”¯æŒä¸å¤–éƒ¨å·¥å…·ï¼ˆå¦‚ Neptune å’Œ TensorBoardï¼‰çš„é›†æˆã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                                                                         | åŠŸèƒ½æè¿°                                                                                      |
|--------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| `code\ultralytics\data\explorer\explorer.py`                                                   | å®ç°å›¾åƒæ•°æ®é›†çš„æ¢ç´¢å·¥å…·ï¼Œæ”¯æŒç›¸ä¼¼æ€§æœç´¢å’Œæ•°æ®æŸ¥è¯¢ï¼Œç»“åˆæ·±åº¦å­¦ä¹ æ¨¡å‹çš„åµŒå…¥åŠŸèƒ½ã€‚               |
| `code\ui.py`                                                                                    | è¿è¡Œ Streamlit åº”ç”¨ï¼Œæä¾›ä¸€ä¸ªç®€å•çš„ç•Œé¢æ¥å±•ç¤ºæ¨¡å‹è®­ç»ƒå’Œç»“æœã€‚                                |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\utils\ops.py`       | å®ç°åŒˆç‰™åˆ©åŒ¹é…ç®—æ³•ï¼Œå¤„ç†ç›®æ ‡æ£€æµ‹ä¸­çš„åˆ†é…é—®é¢˜ï¼Œå¹¶æä¾›å¯¹æ¯”å»å™ªè®­ç»ƒç»„çš„ç”Ÿæˆã€‚                     |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\modules\utils.py`      | æä¾›æ·±åº¦å­¦ä¹ æ¨¡å‹çš„å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬æ¨¡å—å…‹éš†ã€æƒé‡åˆå§‹åŒ–å’Œå¤šå°ºåº¦å¯å˜å½¢æ³¨æ„åŠ›æœºåˆ¶çš„å®ç°ã€‚          |
| `code\ultralytics\utils\callbacks\neptune.py`                                                  | é›†æˆ NeptuneAIï¼Œç”¨äºè®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„å®éªŒæ•°æ®å’Œç»“æœï¼Œæ”¯æŒå¯è§†åŒ–å’Œç›‘æ§ã€‚                      |
| `train.py`                                                                                      | å®ç° YOLO æ¨¡å‹çš„è®­ç»ƒæµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®é›†æ„å»ºã€æ¨¡å‹è®­ç»ƒã€æŸå¤±è®¡ç®—å’Œç»“æœå¯è§†åŒ–ã€‚                   |
| `code\ultralytics\data\dataset.py`                                                              | å¤„ç†æ•°æ®é›†çš„åŠ è½½å’Œé¢„å¤„ç†ï¼Œæä¾›æ•°æ®å¢å¼ºå’Œæ‰¹é‡åŠ è½½åŠŸèƒ½ã€‚                                       |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\yolo\classify\__init__.py` | åˆå§‹åŒ– YOLO åˆ†ç±»æ¨¡å‹æ¨¡å—ï¼Œæä¾›åˆ†ç±»ç›¸å…³çš„åŠŸèƒ½å’Œæ¥å£ã€‚                                          |
| `code\ultralytics\hub\__init__.py`                                                             | æä¾›æ¨¡å‹çš„åŠ è½½å’Œç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒä» Ultralytics Hub ä¸‹è½½å’Œä½¿ç”¨æ¨¡å‹ã€‚                             |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\trackers\utils\__init__.py` | åˆå§‹åŒ–è·Ÿè¸ªå™¨æ¨¡å—ï¼Œæä¾›ç›®æ ‡è·Ÿè¸ªç›¸å…³çš„åŠŸèƒ½å’Œæ¥å£ã€‚                                              |
| `code\ultralytics\trackers\utils\gmc.py`                                                      | å®ç°å…¨å±€è¿åŠ¨è¡¥å¿ï¼ˆGMCï¼‰ç®—æ³•ï¼Œç”¨äºæé«˜ç›®æ ‡è·Ÿè¸ªçš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚                               |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\plotting.py`        | æä¾›å¯è§†åŒ–å·¥å…·ï¼Œç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡ã€æŸå¤±æ›²çº¿å’Œæ ·æœ¬å›¾åƒç­‰ã€‚                                   |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\callbacks\tensorboard.py` | é›†æˆ TensorBoardï¼Œç”¨äºè®°å½•å’Œå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’ŒæŸå¤±ï¼Œä¾¿äºåˆ†ææ¨¡å‹æ€§èƒ½ã€‚                  |

è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†æ¯ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå±•ç¤ºäº†æ•´ä¸ªé¡¹ç›®çš„æ¨¡å—åŒ–ç»“æ„å’Œå„éƒ¨åˆ†ä¹‹é—´çš„åä½œå…³ç³»ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/ZpuVkpZw](https://mbd.pub/o/bread/ZpuVkpZw)